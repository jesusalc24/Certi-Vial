<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Certi-Vial</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Certi-Vial">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        /* --- TEMA 3D DEEP GLASS --- */
        :root {
            --bg-base: #020005;
            --bg-gradient: radial-gradient(at 0% 0%, rgba(120, 50, 255, 0.4) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(50, 200, 255, 0.3) 0px, transparent 50%);
            --primary: #d8b4fe; --secondary: #22d3ee; --accent: #f472b6;
            --text: #ffffff; --text-dim: #94a3b8; --error: #fb7185; --success: #4ade80;
        }

        body {
            margin: 0; font-family: 'Outfit', sans-serif; background-color: var(--bg-base); background-image: var(--bg-gradient); background-attachment: fixed; background-size: cover; color: var(--text); display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; overscroll-behavior-y: none; touch-action: none;
        }

        #app {
            width: 100%; max-width: 600px; height: 100vh; background: rgba(20, 20, 30, 0.6); backdrop-filter: blur(40px) saturate(150%); -webkit-backdrop-filter: blur(40px) saturate(150%); border: 1px solid rgba(255, 255, 255, 0.08); border-top: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 40px 80px -20px rgba(0,0,0,0.8); display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        header {
            padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.03); padding-top: env(safe-area-inset-top, 20px); z-index: 50; background: rgba(0,0,0,0.2); flex-shrink: 0;
        }
        h1 { margin: 0; font-size: 1.4rem; font-weight: 800; letter-spacing: -1px; background: linear-gradient(to right, #fff, #cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-right { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        button.reset { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.05); color: var(--text-dim); padding: 6px 12px; border-radius: 30px; cursor: pointer; transition: 0.3s; font-weight: 600; font-size: 0.7rem; font-family: 'Outfit', sans-serif; touch-action: manipulation; }
        button.reset:hover { background: rgba(251, 113, 133, 0.15); color: #fff; border-color: var(--error); }
        #timer-display { font-family: 'JetBrains Mono', monospace; font-size: 1rem; color: var(--secondary); font-weight: 700; text-shadow: 0 0 10px rgba(34, 211, 238, 0.4); opacity: 0; transition: opacity 0.5s; }
        #timer-display.active { opacity: 1; }
        #timer-display.danger { color: var(--error); animation: pulse-text 1s infinite; }
        @keyframes pulse-text { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- VISTAS --- */
        .view {
            display: none; 
            width: 100%; height: 100%; flex-direction: column;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            padding: 25px; position: relative; box-sizing: border-box;
        }
        
        .view.active {
            display: flex; 
            animation: fadeIn 0.3s ease-out;
        }
        
        #v-game.active { padding: 0; overflow: hidden; }

        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        /* UI General */
        .spotlight { position: relative; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 24px; overflow: hidden; cursor: pointer; transition: transform 0.1s, box-shadow 0.3s, border-color 0.3s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); -webkit-tap-highlight-color: transparent; }
        .spotlight:hover { border-color: rgba(255,255,255,0.2); }
        .spotlight:active { transform: translateY(4px); box-shadow: 0 0 0 rgba(0,0,0,0); }
        .card-btn { padding: 25px; margin-bottom: 15px; display: flex; align-items: center; transition: 0.3s; flex-shrink: 0; }
        .card-selected { background: rgba(74, 222, 128, 0.15) !important; border-color: var(--success) !important; box-shadow: 0 0 30px rgba(74, 222, 128, 0.3) !important; transform: scale(0.96) !important; }
        .card-btn h3 { margin: 0 0 5px 0; color: #fff; font-size: 1.2rem; font-weight: 700; }
        .card-btn small { color: var(--text-dim); font-weight: 500; }
        .card-icon { font-size: 2.5rem; margin-right: 20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }
        
        .lvl-row { padding: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 20px; background: rgba(255,255,255,0.02); transition: 0.2s; flex-shrink: 0; }
        .lvl-row.unlocked:hover { background: rgba(255,255,255,0.05); transform: translateX(5px); }
        .lvl-row.locked { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 0.65rem; font-weight: 800; background: #111; color: var(--text-dim); border: 1px solid #333; }
        .unlocked .badge { background: var(--primary); color: #000; border: none; box-shadow: 0 0 15px var(--primary); }

        /* Estudio */
        .study-scroll { display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding-right: 10px; flex: 1; }
        .study-card { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05); border-left: 4px solid var(--secondary); border-radius: 16px; padding: 20px; animation: slideIn 0.4s ease-out forwards; flex-shrink: 0; }
        .study-q { color: var(--secondary); font-size: 0.9rem; font-weight: 800; margin-bottom: 8px; text-transform: uppercase; line-height: 1.3; }
        .study-a { font-size: 1.05rem; color: #ddd; line-height: 1.5; font-weight: 400; }
        @keyframes slideIn { from {opacity:0; transform:translateX(-20px);} to {opacity:1; transform:translateX(0);} }

        .action-btn { width: 100%; padding: 20px; background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)); color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem; margin-top: 20px; text-align: center; font-family: 'Outfit', sans-serif; border-bottom: 4px solid rgba(0,0,0,0.3); touch-action: manipulation; flex-shrink: 0; }
        .action-btn.primary { background: linear-gradient(135deg, rgba(192, 132, 252, 0.2), rgba(34, 211, 238, 0.1)); border: 1px solid rgba(192, 132, 252, 0.3); border-bottom: 4px solid rgba(192, 132, 252, 0.3); }

        /* Examen */
        .progress { height: 6px; background: rgba(255,255,255,0.05); margin-bottom: 20px; border-radius: 10px; overflow: hidden; flex-shrink: 0; }
        .bar { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--primary)); width: 0%; transition: 0.8s ease; }
        .q-box { min-height: 100px; margin-bottom: 20px; font-size: 1.2rem; line-height: 1.4; font-weight: 600; color:#fff; flex-shrink: 0; }
        .opt-btn { display: block; width: 100%; padding: 20px; margin-bottom: 12px; text-align: left; font-size: 1rem; color: #ccc; font-family: 'Outfit', sans-serif; touch-action: manipulation; flex-shrink: 0; }
        .opt-btn:hover { color: white; background: rgba(255,255,255,0.08); }
        textarea { width: 100%; height: 150px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 20px; border-radius: 20px; font-size: 1rem; outline: none; font-family: inherit; flex-shrink: 0; }
        
        .mic-btn { width: 80px; height: 80px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; margin: 0 auto 20px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .mic-btn:hover { border-color: var(--primary); box-shadow: 0 0 30px var(--primary); transform: scale(1.1); }
        .mic-btn.recording { background: rgba(251, 113, 133, 0.2); border-color: var(--error); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .score-display { font-size: 5rem; text-align: center; font-weight: 900; margin: 20px 0; letter-spacing: -3px; }
        .cert { border: 1px solid rgba(255,255,255,0.1); padding: 30px; margin-top: 30px; background: #fff; color: #000; position: relative; text-align: center; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .stamp { position: absolute; top: 20px; right: 20px; border: 4px solid #d32f2f; color: #d32f2f; padding: 5px 15px; border-radius: 10px; font-weight: 900; transform: rotate(-15deg); }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

        /* --- ESTILOS DEL MINIJUEGO --- */
        .arcade-card { border: 1px solid rgba(244, 114, 182, 0.4); background: linear-gradient(135deg, rgba(244, 114, 182, 0.1), transparent); }
        .arcade-card h3 { color: #f472b6; text-shadow: 0 0 10px rgba(244, 114, 182, 0.5); }
        
        #game-layer { position: relative; width: 100%; height: 100%; background: #0f172a; overflow: hidden; display: flex; flex-direction: column; }
        #sim-canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; }
        
        .hud { position: absolute; top: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; pointer-events: none; font-family: 'JetBrains Mono', monospace; font-weight: bold; text-shadow: 0 2px 4px #000; z-index: 20; }
        .hud-box { background: rgba(0,0,0,0.6); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); font-size: 0.9rem; }
        .spd-val { color: var(--secondary); font-size: 1.1rem; }
        
        .game-controls { position: absolute; bottom: 30px; width: 100%; height: 140px; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 30; pointer-events: none; }
        .d-pad, .pedals { display: flex; gap: 15px; pointer-events: auto; align-items: flex-end; }
        
        .ctrl-btn { width: 75px; height: 75px; border-radius: 18px; border: none; background: rgba(255,255,255,0.1); color: #fff; font-size: 2rem; backdrop-filter: blur(5px); box-shadow: 0 4px 0 rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); transition: 0.1s; }
        .ctrl-btn:active, .ctrl-btn.pressed { transform: translateY(4px); box-shadow: none; background: rgba(255,255,255,0.3); }
        .btn-brake { background: rgba(239, 68, 68, 0.3); border-color: #ef4444; height: 65px; width: 65px; font-size: 1.5rem; align-self: flex-end; margin-bottom: 5px; }
        .btn-gas { background: rgba(34, 197, 94, 0.3); border-color: #22c55e; height: 95px; width: 85px; font-size: 2.8rem; }

        .pc-hint { position: absolute; bottom: 180px; width: 100%; text-align: center; color: rgba(255,255,255,0.3); font-size: 0.8rem; pointer-events: none; }
        
        /* Setup Menu (Garaje) */
        #game-setup { 
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background: rgba(15,23,42,0.95); z-index: 50; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
        }
        .setup-form { width: 100%; max-width: 350px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; color: var(--text-dim); font-size: 0.9rem; margin-bottom: 5px; }
        .form-control { 
            width: 100%; padding: 15px; background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1); color: #fff; border-radius: 12px; font-size: 1rem;
            outline: none;
        }
        .form-control:focus { border-color: var(--primary); }
        
        #game-msg { position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); background: rgba(0,0,0,0.95); padding: 30px; border-radius: 20px; border: 2px solid var(--error); text-align: center; display: none; z-index: 100; min-width: 280px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
    </style>
</head>
<body>

<div id="app">
    <header id="app-header">
        <h1>Certi-Vial</h1>
        <div class="header-right">
            <button class="reset" onclick="app.reset()">‚ü≥ Reiniciar</button>
            <div id="timer-display">15:00</div>
        </div>
    </header>

    <div id="v-home" class="view active">
        <p style="text-align:center; color:var(--text-dim); margin-bottom:40px; font-size:1.1rem;">Seleccione su categor√≠a:</p>
        
        <div class="card-btn spotlight" onclick="app.setCat('A-I', this)">
            <div class="card-icon">üöó</div>
            <div><h3>Veh√≠culo Particular</h3><small>Categor√≠a A-I</small></div>
        </div>
        
        <div class="card-btn spotlight" onclick="app.setCat('B-IIc', this)">
            <div class="card-icon">üõ∫</div>
            <div><h3>Mototaxi</h3><small>Categor√≠a B-IIc</small></div>
        </div>

        <div style="width:100%; height:1px; background:rgba(255,255,255,0.1); margin: 25px 0;"></div>

        <div class="card-btn spotlight arcade-card" onclick="Game.init()">
            <div class="card-icon">üïπÔ∏è</div>
            <div><h3 style="color:#f472b6">Modo Arcade</h3><small>Taller & Simulador 3D</small></div>
        </div>
    </div>

    <div id="v-levels" class="view">
        <div style="display:flex; justify-content:space-between; margin-bottom:30px; align-items:center;">
            <h3 style="margin:0; font-size:1.5rem;">Niveles</h3>
            <span id="cat-lbl" style="color:var(--primary); font-weight:bold; background:rgba(255,255,255,0.05); padding:8px 16px; border-radius:12px;">CAT</span>
        </div>
        <div id="lvl-list"></div>
        <button class="action-btn spotlight" onclick="app.nav('v-home')">Volver al Inicio</button>
    </div>

    <div id="v-study" class="view">
        <h3 style="text-align:center; margin:0; color:var(--secondary); letter-spacing:2px; font-size:0.9rem;">PREPARACI√ìN</h3>
        <p style="text-align:center; color:var(--text-dim); font-size:1.2rem; margin-bottom:30px; font-weight:300;">Micro-Sesi√≥n de Estudio</p>
        <div id="study-container" class="study-scroll"></div>
        <button class="action-btn spotlight primary" onclick="app.startExam()">¬°Estoy Listo!</button>
    </div>

    <div id="v-exam" class="view">
        <div class="progress"><div id="bar" class="bar"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.9rem; color:var(--text-dim); margin-bottom:15px; text-transform:uppercase; font-weight:700; letter-spacing:1px;">
            <span id="ex-name">Nivel</span>
            <span id="ex-count">0/0</span>
        </div>
        <div id="q-text" class="q-box">Pregunta...</div>
        <div id="q-area"></div>
    </div>

    <div id="v-result" class="view">
        <h2 style="text-align:center; margin-top:0; color:var(--text);">Resultados</h2>
        <div id="res-val" class="score-display">0</div>
        <p id="res-msg" style="text-align:center; color:var(--text-dim); margin-bottom:30px; font-size:1.2rem;"></p>

        <div id="cert" class="cert" style="display:none">
            <div class="stamp">APROBADO</div>
            <h2 style="margin:0 0 20px 0; letter-spacing:3px;">CERTIFICADO</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; text-align:left; border-top:2px dashed #999; padding-top:20px;">
                <p style="margin:5px 0"><strong>Categor√≠a:</strong> <span id="c-cat">A</span></p>
                <p style="margin:5px 0"><strong>Nivel:</strong> <span id="c-lvl">1</span></p>
                <p style="margin:5px 0; grid-column:span 2; font-size:1.2rem;"><strong>Nota:</strong> <span id="c-note" style="font-weight:900">OK</span></p>
            </div>
        </div>
        <button class="action-btn spotlight primary" onclick="app.nav('v-levels'); app.renderLvl()">Continuar</button>
    </div>

    <div id="v-game" class="view">
        <div id="game-setup">
            <h2 style="color:var(--primary); margin-bottom:20px; font-size:1.8rem;">TALLER VIRTUAL</h2>
            <div class="setup-form">
                <div class="form-group">
                    <label>Nombre de Piloto</label>
                    <input type="text" id="p-name" class="form-control" placeholder="Tu nombre..." value="Conductor">
                </div>
                <div class="form-group">
                    <label>Modelo de Veh√≠culo</label>
                    <select id="p-model" class="form-control" style="background:#222">
                        <option value="sedan">Sed√°n (Est√°ndar)</option>
                        <option value="sport">Deportivo (Ancho)</option>
                        <option value="suv">Camioneta (Largo)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Color de Pintura</label>
                    <input type="color" id="p-color" class="form-control" value="#3b82f6" style="height:50px; padding:0; cursor:pointer;">
                </div>
                <div class="form-group" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <div>
                        <label>Lunas</label>
                        <select id="p-win" class="form-control" style="background:#222">
                            <option value="#1e3a8a">Normales</option>
                            <option value="#000">Polarizadas</option>
                        </select>
                    </div>
                    <div>
                        <label>Luces</label>
                        <select id="p-light" class="form-control" style="background:#222">
                            <option value="#fef08a">Hal√≥genas</option>
                            <option value="#06b6d4">Xen√≥n</option>
                            <option value="#d946ef">Ne√≥n</option>
                        </select>
                    </div>
                </div>
                <button class="action-btn spotlight primary" onclick="Game.launch()">SALIR A PISTA</button>
                <button class="action-btn" onclick="app.nav('v-home')">VOLVER</button>
            </div>
        </div>

        <div id="game-layer">
            <div class="hud">
                <div class="hud-box"><span id="hud-name" style="color:#aaa; display:block; font-size:0.7rem">PLAYER</span>VEL: <span id="hud-spd" class="spd-val">0</span> km/h</div>
                <div class="hud-box">DIST: <span id="hud-dist">0</span> m</div>
            </div>

            <canvas id="sim-canvas"></canvas>

            <div id="game-msg">
                <div style="font-size:3rem; margin-bottom:10px;">üëÆ‚Äç‚ôÇÔ∏è</div>
                <h2 style="color:var(--error); margin:0 0 10px 0;">¬°INFRACCI√ìN!</h2>
                <p id="fail-reason" style="font-size:1.1rem; margin-bottom:25px; color:var(--text-muted);"></p>
                <button class="ctrl-btn" style="width:100%; height:50px; font-size:1rem; background:var(--secondary); color:#000;" onclick="Game.init()">REINTENTAR</button>
                <br><br>
                <button class="ctrl-btn" style="width:100%; height:40px; font-size:0.8rem;" onclick="app.nav('v-home')">Salir al Men√∫</button>
            </div>

            <div class="pc-hint">Usa FLECHAS o WASD para conducir</div>
            
            <div class="game-controls">
                <div class="d-pad">
                    <button class="ctrl-btn" id="btn-left">‚¨ÖÔ∏è</button>
                    <button class="ctrl-btn" id="btn-right">‚û°Ô∏è</button>
                </div>
                <div class="pedals">
                    <button class="ctrl-btn btn-brake" id="btn-brake">üõë</button>
                    <button class="ctrl-btn btn-gas" id="btn-gas">üöÄ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ==========================================
// 1. BASE DE DATOS COMPLETA Y ORIGINAL
// ==========================================
const DB = {
    'A1': [
        { q: "1. ¬øCu√°l es la acci√≥n correcta si usted llega a una intersecci√≥n no semaforizada y encuentra una se√±al de 'PARE' (R-1)?", opts: ["a) Disminuir la velocidad y pasar si no viene nadie.", "b) Tocar el claxon y avanzar r√°pidamente.", "c) Detenerse por completo y ceder el paso a los veh√≠culos de la v√≠a transversal.", "d) Detenerse solo si hay un polic√≠a de tr√°nsito."], a: 2, learn: "üõë **PARE:** Detenci√≥n total y obligatoria. Solo reinicias la marcha cuando sea seguro." },
        { q: "2. Seg√∫n el Reglamento Nacional de Tr√°nsito, en una rotonda, ¬øqui√©n tiene la prioridad de paso?", opts: ["a) El veh√≠culo que quiere ingresar a la rotonda.", "b) El veh√≠culo que circula por la v√≠a con m√°s carriles.", "c) El veh√≠culo que ya se encuentra circulando dentro de la rotonda.", "d) El veh√≠culo m√°s grande (cami√≥n o bus)."], a: 2, learn: "üîÑ **Rotonda:** La preferencia la tiene quien ya circula DENTRO de ella sobre el que intenta ingresar." },
        { q: "3. ¬øQu√© indica una l√≠nea amarilla doble continua en el centro de la calzada?", opts: ["a) Que se puede adelantar con precauci√≥n.", "b) Que est√° totalmente prohibido cruzar la l√≠nea para adelantar a otro veh√≠culo (es una barrera imaginaria).", "c) Que es una zona de estacionamiento.", "d) Que el sentido del tr√°nsito es √∫nico."], a: 1, learn: "üöß **Doble Amarilla:** Es un muro virtual. Est√° prohibido cruzarla para adelantar en ambos sentidos." },
        { q: "4. ¬øCu√°l es el l√≠mite m√°ximo de velocidad permitido en zonas escolares?", opts: ["a) 20 km/h.", "b) 30 km/h.", "c) 40 km/h.", "d) 35 km/h."], a: 1, learn: "üè´ **Zona Escolar:** Velocidad m√°xima 30 km/h para proteger a los ni√±os." },
        { q: "5. Si usted conduce un veh√≠culo particular, ¬øcu√°l es el l√≠mite m√°ximo de alcohol en la sangre permitido?", opts: ["a) 0.25 gramos por litro.", "b) 0.50 gramos por litro.", "c) 0.80 gramos por litro.", "d) 0.00 gramos por litro (Tolerancia cero)."], a: 1, learn: "üç∑ **Alcohol:** Para conductores particulares, el l√≠mite es 0.50 g/l. Pasado eso es delito." },
        { q: "6. ¬øQu√© luces debe utilizar al conducir en carretera durante la noche o en situaciones de poca visibilidad, siempre que no deslumbre a otros conductores?", opts: ["a) Luces de posici√≥n.", "b) Luces bajas √∫nicamente.", "c) Luces altas (carretera).", "d) Luces intermitentes de emergencia."], a: 2, learn: "üí° **Luces Altas:** Se usan en carretera para ver lejos, pero deben bajarse si viene otro veh√≠culo." },
        { q: "7. ¬øCu√°ndo est√° permitido usar la bocina (claxon) en la ciudad?", opts: ["a) Para apurar al conductor de adelante.", "b) Para llamar la atenci√≥n de un peat√≥n conocido.", "c) Solamente para evitar situaciones peligrosas o accidentes inminentes.", "d) Cuando hay congesti√≥n vehicular para avisar que avanza."], a: 2, learn: "üì¢ **Claxon:** Su uso es excepcional, solo para evitar un peligro inminente, nunca para apurar." },
        { q: "8. ¬øQu√© significa la luz √°mbar o amarilla fija en el sem√°foro?", opts: ["a) Que debe acelerar para ganar el paso.", "b) Que los veh√≠culos deben detenerse antes de entrar a la intersecci√≥n, salvo que no puedan hacerlo con seguridad.", "c) Que el sem√°foro est√° malogrado.", "d) Que tiene preferencia de paso sobre los peatones."], a: 1, learn: "‚ö†Ô∏è **√Åmbar:** Indica detenerse si es seguro. No se debe acelerar para ganar el paso." },
        { q: "9. ¬øCu√°l es la frecuencia de la Revisi√≥n T√©cnica para veh√≠culos particulares (M1) una vez que cumplen 4 a√±os de antig√ºedad desde su fabricaci√≥n?", opts: ["a) Cada 6 meses.", "b) Cada 2 a√±os.", "c) Anualmente.", "d) Cada 5 a√±os."], a: 2, learn: "üîß **CITV:** Autos particulares pasan revisi√≥n t√©cnica cada a√±o (Anualmente)." },
        { q: "10. Si presencia un accidente con heridos, ¬øcu√°l es su primera obligaci√≥n como conductor?", opts: ["a) Tomar fotos para el seguro.", "b) Seguir su camino para no obstruir el tr√°fico.", "c) Detenerse inmediatamente, prestar auxilio y solicitar ayuda a la autoridad competente.", "d) Llamar a su mec√°nico."], a: 2, learn: "üöë **Auxilio:** Es obligatorio detenerse y ayudar si presencias un accidente." },
        { q: "11. ¬øEst√° permitido estacionar su veh√≠culo sobre un paso peatonal (cebra)?", opts: ["a) S√≠, si es por menos de 5 minutos.", "b) No, est√° prohibido en cualquier circunstancia.", "c) S√≠, si deja las luces de emergencia encendidas.", "d) S√≠, si es domingo o feriado."], a: 1, learn: "ü¶ì **Paso Cebra:** Es zona r√≠gida absoluta. Jam√°s se debe estacionar sobre ella." },
        { q: "12. ¬øQu√© documento acredita que el veh√≠culo cuenta con una p√≥liza de seguro vigente para cubrir da√±os a personas en accidentes de tr√°nsito?", opts: ["a) La Tarjeta de Identificaci√≥n Vehicular.", "b) El brevete.", "c) El certificado SOAT (f√≠sico o electr√≥nico).", "d) El DNI del conductor."], a: 2, learn: "üìÑ **SOAT:** Es el seguro obligatorio que cubre gastos m√©dicos de v√≠ctimas (ocupantes y peatones)." },
        { q: "13. En una intersecci√≥n no regulada (sin se√±ales ni sem√°foros), ¬øqui√©n tiene la preferencia de paso?", opts: ["a) El veh√≠culo que llega primero.", "b) El veh√≠culo que circula por la v√≠a pavimentada frente a una v√≠a no pavimentada.", "c) El veh√≠culo que va m√°s r√°pido.", "d) El veh√≠culo que ingresa por la izquierda."], a: 1, learn: "üõ£Ô∏è **Prioridad:** La v√≠a pavimentada (asfalto) tiene preferencia sobre la no pavimentada (tierra)." },
        { q: "14. ¬øQu√© sanci√≥n recibe un conductor que se niega a pasar la prueba de alcoholemia?", opts: ["a) Una multa simple.", "b) Suspensi√≥n de la licencia, multa y retenci√≥n del veh√≠culo (se presume estado de ebriedad).", "c) Solo una amonestaci√≥n verbal.", "d) Se le permite ir a casa en taxi."], a: 1, learn: "üö´ **Negativa:** Negarse al dosaje et√≠lico se sanciona igual que dar positivo (Muy Grave)." },
        { q: "15. ¬øEs obligatorio el uso del cintur√≥n de seguridad para los pasajeros de los asientos traseros?", opts: ["a) No, solo es obligatorio para el piloto y copiloto.", "b) S√≠, es obligatorio para todos los ocupantes del veh√≠culo.", "c) Solo si viajan ni√±os.", "d) Solo en carreteras, no en la ciudad."], a: 1, learn: "üîí **Cintur√≥n:** Todos los ocupantes del veh√≠culo deben usarlo, tanto adelante como atr√°s." },
        { q: "16. ¬øQu√© indica una se√±al vertical en forma de rombo con fondo amarillo y s√≠mbolos negros?", opts: ["a) Es una se√±al Informativa (gu√≠a al conductor).", "b) Es una se√±al Reguladora (prohibici√≥n).", "c) Es una se√±al Preventiva (advierte de un peligro).", "d) Es una se√±al Tur√≠stica."], a: 2, learn: "‚ö†Ô∏è **Preventiva:** El rombo amarillo advierte sobre peligros en la v√≠a (curvas, cruces, etc.)." },
        { q: "17. Al cambiar de carril o voltear, ¬øcon cu√°nta anticipaci√≥n debe encender las luces direccionales en zona urbana?", opts: ["a) 2 segundos antes.", "b) Por lo menos 30 metros antes (o unos segundos antes de la maniobra).", "c) Justo en el momento que gira el volante.", "d) No es necesario si no vienen autos."], a: 1, learn: "‚ÜîÔ∏è **Se√±alizar:** Debe avisar su maniobra al menos 30 metros antes de girar." },
        { q: "18. Si su licencia de conducir vence, ¬øcu√°nto tiempo puede seguir conduciendo antes de revalidarla?", opts: ["a) 30 d√≠as.", "b) 6 meses.", "c) Ning√∫n tiempo, no se puede conducir con la licencia vencida.", "d) Hasta que un polic√≠a lo detenga."], a: 2, learn: "üìÖ **Vencimiento:** No hay periodo de gracia. Licencia vencida = Prohibido conducir." },
        { q: "19. ¬øQu√© significa una flecha verde en un sem√°foro vehicular?", opts: ["a) Que puede avanzar en cualquier direcci√≥n.", "b) Que puede avanzar √∫nicamente en la direcci√≥n indicada por la flecha.", "c) Que debe esperar la luz verde circular.", "d) Que la v√≠a est√° libre de peatones."], a: 1, learn: "üü¢ **Flecha:** Solo permite ir en la direcci√≥n que apunta la flecha." },
        { q: "20. En pendientes pronunciadas (subidas/bajadas) donde no pueden pasar dos veh√≠culos a la vez, ¬øqui√©n tiene la preferencia?", opts: ["a) El veh√≠culo que baja (desciende).", "b) El veh√≠culo que sube (asciende).", "c) El veh√≠culo m√°s peque√±o.", "d) El que toque el claxon primero."], a: 1, learn: "‚õ∞Ô∏è **Pendientes:** El veh√≠culo que sube tiene preferencia sobre el que baja." }
    ],
    'A2': [
        { q: "1. Si usted se aproxima a una intersecci√≥n sin sem√°foros y ve una se√±al de 'CEDA EL PASO' (R-2), ¬øqu√© debe hacer?", opts: ["a) Tocar el claxon y avanzar con cuidado.", "b) Detenerse obligatoriamente aunque no vengan veh√≠culos.", "c) Disminuir la velocidad y detenerse solo si es necesario para ceder el paso a veh√≠culos o peatones.", "d) Acelerar para cruzar antes que los otros veh√≠culos."], a: 2, learn: "üîΩ **Ceda el Paso:** No obliga a detenerse si la v√≠a est√° libre, pero debes bajar la velocidad." },
        { q: "2. Seg√∫n el Reglamento Nacional de Tr√°nsito, ¬øcu√°l es el l√≠mite m√°ximo de velocidad en calles de zona urbana (no avenidas)?", opts: ["a) 30 km/h.", "b) 40 km/h.", "c) 50 km/h.", "d) 60 km/h."], a: 1, learn: "üè† **Velocidad Calle:** En calles urbanas (no avenidas), el l√≠mite usado en el examen es 40 km/h." },
        { q: "3. ¬øQu√© indica una l√≠nea central amarilla discontinua (segmentada) en la calzada?", opts: ["a) Que la v√≠a es de un solo sentido.", "b) Que est√° prohibido adelantar en ambos sentidos.", "c) Que la v√≠a es de doble sentido y se permite adelantar si hay visibilidad y seguridad.", "d) Que es una zona de estacionamiento temporal."], a: 2, learn: "üü° **L√≠nea Segmentada:** Permite adelantar invadiendo el carril contrario con cuidado." },
        { q: "4. Si su licencia de conducir Clase A Categor√≠a I tiene la restricci√≥n 'Uso de lentes', ¬øqu√© sucede si conduce sin ellos?", opts: ["a) No pasa nada si es de d√≠a.", "b) Es una falta leve y solo recibe una amonestaci√≥n.", "c) Es una infracci√≥n Grave (G.19) sancionada con multa y puntos.", "d) Solo le pedir√°n que se los ponga en ese momento."], a: 2, learn: "üëì **Lentes:** Es una infracci√≥n Grave conducir sin los correctores visuales indicados en la licencia." },
        { q: "5. En una rotonda (√≥valo), ¬øqui√©n tiene la prioridad de paso?", opts: ["a) El veh√≠culo que intenta ingresar a la rotonda.", "b) El veh√≠culo que va m√°s r√°pido.", "c) El veh√≠culo que ya se encuentra circulando dentro de la rotonda.", "d) El veh√≠culo de transporte p√∫blico."], a: 2, learn: "üîÑ **Rotonda:** Quien circula dentro tiene la preferencia." },
        { q: "6. Seg√∫n el Reglamento Nacional de Veh√≠culos, ¬øcu√°l es la profundidad m√≠nima requerida en los surcos de los neum√°ticos para un autom√≥vil (categor√≠a M1)?", opts: ["a) 1.0 mm.", "b) 1.6 mm.", "c) 2.0 mm.", "d) 3.0 mm."], a: 1, learn: "üìè **Llantas:** La profundidad m√≠nima legal para autos es 1.6 mm." },
        { q: "7. ¬øQu√© significa la luz intermitente roja en un sem√°foro?", opts: ["a) Que el sem√°foro est√° malogrado y puede pasar con precauci√≥n.", "b) Equivale a una se√±al de 'PARE': debe detenerse por completo y avanzar solo cuando sea seguro.", "c) Equivale a una se√±al de 'CEDA EL PASO': solo debe bajar la velocidad.", "d) Que debe esperar a la luz verde."], a: 1, learn: "üõë **Roja Intermitente:** Funciona como un PARE. Detenci√≥n total obligatoria." },
        { q: "8. ¬øA qu√© distancia m√≠nima de una esquina o intersecci√≥n est√° permitido estacionar?", opts: ["a) 3 metros.", "b) 5 metros.", "c) 6 metros (salvo se√±alizaci√≥n en contrario).", "d) 10 metros."], a: 3, learn: "üìê **Esquina:** Se debe dejar 10 metros libres para no bloquear la visi√≥n." },
        { q: "9. ¬øQu√© documento debe portar obligatoriamente y mostrar a la autoridad si su veh√≠culo tiene m√°s de 4 a√±os de antig√ºedad?", opts: ["a) La factura de compra original.", "b) El Certificado de Inspecci√≥n T√©cnica Vehicular (CITV) vigente.", "c) El manual de usuario del veh√≠culo.", "d) El contrato de seguro vehicular contra robos."], a: 1, learn: "üîß **CITV:** Obligatorio a partir del 4to a√±o de antig√ºedad." },
        { q: "10. Si se encuentra con un veh√≠culo de emergencia (ambulancia, bomberos) con luces y sirenas encendidas, ¬øqu√© debe hacer?", opts: ["a) Acelerar para no estorbar su paso.", "b) Mantener su velocidad y carril.", "c) Desplazarse hacia la derecha y detenerse si es necesario para cederle el paso.", "d) Tocar claxon para avisar a otros conductores."], a: 2, learn: "üöë **Emergencia:** Orillarse a la derecha y detenerse." },
        { q: "11. ¬øQu√© indica la se√±al vertical P-33A (un tri√°ngulo amarillo con una 'joroba' negra al centro)?", opts: ["a) Puente angosto.", "b) Proximidad de un reductor de velocidad (rompemuelles).", "c) Pavimento resbaladizo.", "d) Zona de derrumbes."], a: 1, learn: "üöß **P-33A:** Advierte la presencia de un rompemuelles (resalto)." },
        { q: "12. En una v√≠a de tres carriles de un mismo sentido, ¬øcu√°l carril se debe utilizar para adelantar?", opts: ["a) Cualquiera de los tres.", "b) El carril de la derecha.", "c) El carril del centro.", "d) El carril del extremo izquierdo."], a: 3, learn: "‚¨ÖÔ∏è **Adelantar:** Siempre se usa el carril izquierdo para rebasar." },
        { q: "13. Seg√∫n el Reglamento de Licencias, la vigencia de la licencia A-I es de 10 a√±os, pero si el conductor ha sido sancionado con inhabilitaci√≥n temporal, la vigencia de su renovaci√≥n ser√° de:", opts: ["a) 8 a√±os.", "b) 5 a√±os.", "c) 3 a√±os.", "d) 2 a√±os."], a: 1, learn: "üìâ **Sanci√≥n:** Si fuiste suspendido, tu nueva licencia solo dura 5 a√±os." },
        { q: "14. ¬øQu√© significa una se√±al reguladora con un c√≠rculo rojo y una l√≠nea diagonal roja sobre una letra 'E'?", opts: ["a) Estacionamiento permitido.", "b) Estacionamiento exclusivo para emergencias.", "c) Prohibido estacionar.", "d) Prohibido detenerse por cualquier motivo."], a: 2, learn: "üö´ **Prohibido Estacionar:** No puedes parquear, pero s√≠ detenerte un momento." },
        { q: "15. ¬øCu√°l es la tasa de alcohol en la sangre permitida para conductores de transporte p√∫blico (incluso taxis)?", opts: ["a) 0.50 g/l.", "b) 0.25 g/l.", "c) 0.10 g/l.", "d) 0.00 g/l (Tolerancia cero al conducir prestando servicio)."], a: 1, learn: "üç∑ **Transporte P√∫blico:** El l√≠mite es m√°s estricto: 0.25 g/l." },
        { q: "16. Si usted llega a una intersecci√≥n no semaforizada donde no hay se√±ales de prioridad, ¬øqui√©n tiene el derecho de paso?", opts: ["a) El veh√≠culo que llega primero.", "b) El veh√≠culo que viene por su derecha.", "c) El veh√≠culo que viene por su izquierda.", "d) El veh√≠culo m√°s grande."], a: 1, learn: "üëâ **Preferencia:** El que aparece por la mano DERECHA tiene el paso." },
        { q: "17. ¬øEst√° permitido el uso de la bocina (claxon) para apurar al conductor de adelante cuando el sem√°foro cambia a verde?", opts: ["a) S√≠, para agilizar el tr√°fico.", "b) S√≠, si es hora punta.", "c) No, est√° prohibido usar la bocina salvo en situaciones de inminente peligro.", "d) S√≠, pero solo un toque corto."], a: 2, learn: "üì¢ **Claxon:** Prohibido usarlo para apurar el tr√°fico." },
        { q: "18. ¬øQu√© indican las l√≠neas de borde de calzada de color amarillo continuo?", opts: ["a) Que se puede estacionar en la berma.", "b) Que la v√≠a es de doble sentido.", "c) Que est√° prohibido el estacionamiento y la detenci√≥n en ese lado de la v√≠a.", "d) Que es una zona escolar."], a: 2, learn: "‚õî **Amarillo Continuo:** Zona r√≠gida. Prohibido detenerse y estacionar." },
        { q: "19. ¬øCu√°l es la sanci√≥n por conducir un veh√≠culo sin tener SOAT vigente?", opts: ["a) Solo una multa (papeleta).", "b) Multa (12% UIT) y retenci√≥n del veh√≠culo.", "c) Amonestaci√≥n verbal.", "d) Retenci√≥n de la licencia de conducir √∫nicamente."], a: 1, learn: "üõë **Sin SOAT:** Multa y veh√≠culo al dep√≥sito." },
        { q: "20. ¬øQu√© significa la se√±al vertical P-48 (un rombo amarillo con la silueta de una persona caminando)?", opts: ["a) Zona escolar.", "b) Prohibido el paso de peatones.", "c) Zona de presencia de peatones (Cruce peatonal pr√≥ximo).", "d) Paradero de buses."], a: 2, learn: "üö∂ **P-48:** Advierte cruce o presencia de peatones." }
    ],
    'B1': [
        { q: "1. Si usted llega a una intersecci√≥n donde el sem√°foro muestra una luz intermitente AMBAR (amarilla), ¬øqu√© conducta debe adoptar?", opts: ["a) Detenerse completamente como si fuera una luz roja.", "b) Disminuir la velocidad y cruzar con precauci√≥n, cediendo el paso si es necesario.", "c) Acelerar para despejar la intersecci√≥n r√°pidamente.", "d) Esperar a que cambie a verde fijo."], a: 1, learn: "‚ö†Ô∏è **√Åmbar Intermitente:** Precauci√≥n. Disminuir velocidad." },
        { q: "2. Seg√∫n el Reglamento de Licencias, la vigencia de la Licencia A-I es de 10 a√±os. Sin embargo, si usted ha sido sancionado con inhabilitaci√≥n temporal, la vigencia de su pr√≥xima licencia ser√° de:", opts: ["a) 8 a√±os.", "b) 5 a√±os.", "c) 3 a√±os.", "d) 2 a√±os."], a: 1, learn: "üìâ **Vigencia:** Se reduce a 5 a√±os por sanci√≥n." },
        { q: "3. ¬øQu√© elemento de seguridad es obligatorio llevar en un veh√≠culo de categor√≠a M1 (auto) adem√°s de la rueda de repuesto?", opts: ["a) Un gal√≥n de agua.", "b) Herramientas para cambio de rueda (gata y llave) y tri√°ngulo de seguridad.", "c) Una soga de remolque.", "d) Cables para pasar corriente."], a: 1, learn: "üîß **Kit:** Gata, llave de ruedas y tri√°ngulo son obligatorios." },
        { q: "4. En la se√±alizaci√≥n horizontal, ¬øqu√© indica una l√≠nea de borde de calzada de color AMARILLO continuo?", opts: ["a) Que se puede estacionar en la berma.", "b) Que la v√≠a es de doble sentido.", "c) Que est√° prohibido el estacionamiento en ese lado de la v√≠a.", "d) Que es una zona de neblina."], a: 2, learn: "üö´ **L√≠nea Amarilla:** Prohibido estacionar." },
        { q: "5. Si usted conduce un veh√≠culo con lunas polarizadas sin la autorizaci√≥n correspondiente, ¬øqu√© tipo de infracci√≥n est√° cometiendo?", opts: ["a) No es infracci√≥n si es de d√≠a.", "b) Infracci√≥n al Reglamento Nacional de Tr√°nsito.", "c) Infracci√≥n administrativa, pero no de tr√°nsito.", "d) Solo es una advertencia verbal."], a: 1, learn: "üëÆ **Polarizado:** Es una infracci√≥n de tr√°nsito si no tienes permiso." },
        { q: "6. Seg√∫n el Manual de Dispositivos, ¬øqu√© significa la se√±al R-4 (C√≠rculo rojo con una barra horizontal blanca al centro 'NO ENTRE')?", opts: ["a) Prohibido estacionar.", "b) Prohibido el ingreso a una zona restringida o contra el sentido del tr√°nsito.", "c) Aduana o Control policial.", "d) Calle sin salida."], a: 1, learn: "‚õî **R-4:** Prohibido el ingreso / Sentido contrario." },
        { q: "7. Para revalidar su licencia A-I, ¬øcu√°l es la vigencia del Certificado de Salud una vez que ha sido expedido e inscrito en el sistema?", opts: ["a) 15 d√≠as.", "b) 30 d√≠as.", "c) 6 meses.", "d) 1 a√±o."], a: 2, learn: "ü©∫ **Salud:** El examen tiene validez de 6 meses." },
        { q: "8. ¬øQu√© categor√≠a de veh√≠culo es una camioneta 'Pick-up' dise√±ada para transporte de carga con un peso bruto menor a 3.5 toneladas?", opts: ["a) M1.", "b) M2.", "c) N1.", "d) N2."], a: 2, learn: "üöõ **N1:** Veh√≠culo de carga liviano." },
        { q: "9. Si usted se encuentra con la se√±al P-33A (Resalto o Rompemuelles), ¬øa qu√© distancia aproximada se encuentra el reductor de velocidad?", opts: ["a) Exactamente en el lugar de la se√±al.", "b) A una distancia m√≠nima de 60 metros antes de la ubicaci√≥n del resalto.", "c) A 500 metros.", "d) A 10 metros."], a: 1, learn: "üöß **Se√±al:** Se coloca 60m antes del peligro." },
        { q: "10. ¬øEst√° permitido que un ni√±o menor de 5 a√±os viaje en el asiento delantero del copiloto?", opts: ["a) S√≠, si lleva cintur√≥n.", "b) S√≠, si va cargado por un adulto.", "c) No, los menores de edad deben viajar en los asientos posteriores (seg√∫n normas de tr√°nsito complementarias a la seguridad).", "d) S√≠, si el auto tiene airbag."], a: 2, learn: "üë∂ **Ni√±os:** Siempre en asientos posteriores." },
        { q: "11. ¬øQu√© indica una se√±al en forma de 'X' (Aspa) de color blanco con el texto 'FERROCARRIL' (P-44)?", opts: ["a) Cruce de peatones.", "b) Zona de obras.", "c) Cruce ferroviario a nivel (Cruz de San Andr√©s).", "d) Intersecci√≥n de dos avenidas principales."], a: 2, learn: "üöÇ **Cruz de San Andr√©s:** Cruce de tren a nivel." },
        { q: "12. Si usted cambia el motor de su veh√≠culo por uno de diferente combustible (ej. gasolina a GLP), ¬øqu√© debe hacer ante la SUNARP?", opts: ["a) Nada, solo guardar la factura.", "b) Solicitar el cambio de caracter√≠sticas en la Tarjeta de Identificaci√≥n Vehicular presentando el Certificado de Conformidad.", "c) Solo debe pasar revisi√≥n t√©cnica.", "d) Avisar a la polic√≠a de tr√°nsito verbalmente."], a: 1, learn: "üìù **Cambio Combustible:** Requiere actualizar la Tarjeta de Propiedad." },
        { q: "13. En una v√≠a con tres carriles en el mismo sentido, si la se√±al R-18 (Camiones a la derecha) est√° presente, ¬øpor d√≥nde deben circular los veh√≠culos pesados?", opts: ["a) Por cualquier carril.", "b) Por el carril izquierdo para ir m√°s r√°pido.", "c) Exclusivamente por el carril derecho.", "d) Por el carril central."], a: 2, learn: "üöö **Camiones:** Siempre a la derecha." },
        { q: "14. ¬øCu√°l es la edad m√°xima para obtener o revalidar una licencia de conducir de categor√≠a profesional (A-II en adelante)?", opts: ["a) 70 a√±os.", "b) 75 a√±os.", "c) 80 a√±os.", "d) No hay l√≠mite de edad."], a: 2, learn: "üë¥ **Edad L√≠mite:** 80 a√±os para profesionales." },
        { q: "15. ¬øQu√© significa la demarcaci√≥n de 'Malla Ortogonal' (cuadr√≠cula amarilla) en una intersecci√≥n?", opts: ["a) Zona de seguridad peatonal.", "b) No bloquear el cruce (prohibido detenerse dentro del recuadro).", "c) Paradero de taxis.", "d) Zona de estacionamiento de emergencia."], a: 1, learn: "‚ùå **Malla:** Prohibido bloquear el cruce." },
        { q: "16. Si su licencia A-I vence, ¬øpuede seguir conduciendo mientras tramita la revalidaci√≥n?", opts: ["a) S√≠, si tiene la constancia del tr√°mite.", "b) S√≠, tiene 30 d√≠as de gracia.", "c) No, est√° prohibida la conducci√≥n con licencia vencida.", "d) S√≠, solo en su distrito."], a: 2, learn: "üö´ **Vencida:** Prohibido conducir sin excepci√≥n." },
        { q: "17. ¬øQu√© indica la se√±al vertical I-19 (Cuadrado azul con s√≠mbolo de surtidor de combustible)?", opts: ["a) Prohibido estacionar.", "b) Zona de carga de combustible (Grifo) pr√≥xima.", "c) Zona de peligro de incendio.", "d) Mec√°nico."], a: 1, learn: "‚õΩ **Se√±al Azul:** Indica grifo cercano." },
        { q: "18. ¬øCu√°l es la profundidad m√≠nima de las ranuras principales de los neum√°ticos para un veh√≠culo de categor√≠a M1 (auto particular)?", opts: ["a) 1.0 mm.", "b) 1.6 mm.", "c) 2.0 mm.", "d) 3.0 mm."], a: 1, learn: "üìè **Neum√°ticos:** 1.6 mm m√≠nimo." },
        { q: "19. En zonas donde no hay se√±ales de velocidad, ¬øcu√°l es el l√≠mite m√°ximo en zonas escolares seg√∫n el Reglamento de Tr√°nsito?", opts: ["a) 20 km/h.", "b) 30 km/h.", "c) 35 km/h.", "d) 40 km/h."], a: 1, learn: "üè´ **Escolar:** 30 km/h." },
        { q: "20. ¬øQu√© sanci√≥n recibe un conductor particular (A-I) si se niega a pasar la prueba de alcoholemia (dosaje et√≠lico)?", opts: ["a) Multa simple.", "b) Se presume la intoxicaci√≥n y conlleva a la suspensi√≥n/cancelaci√≥n de la licencia y multa (Infracci√≥n Muy Grave M.05).", "c) Amonestaci√≥n.", "d) Retenci√≥n del veh√≠culo √∫nicamente."], a: 1, learn: "üç∑ **Negarse:** Es infracci√≥n Muy Grave (M.05)." },
        { q: "21. Explique detalladamente qu√© conducta debe adoptar un conductor al encontrarse con una se√±al de \"CEDA EL PASO\" (R-2) antes de ingresar a una intersecci√≥n o rotonda.", type: "TEXT", key: ["disminuir", "ceder", "velocidad", "detenerse", "preferencia"], learn: "üìâ **R-2:** Disminuir velocidad y ceder el paso. Detenerse si es necesario." },
        { q: "22. De acuerdo con el Reglamento de Licencias de Conducir, ¬øcu√°l es el plazo de vigencia del certificado de salud para licencias de conducir y cu√°l es su alcance territorial (d√≥nde es v√°lido)?", type: "TEXT", key: ["6 meses", "seis meses", "nacional"], learn: "ü©∫ **Salud:** 6 meses de vigencia y validez Nacional." }
    ],
    'B2': [
        { q: "1. Seg√∫n el Reglamento Nacional de Tr√°nsito y el Manual de Dispositivos: ¬øQu√© indica una demarcaci√≥n en el pavimento tipo 'Rejilla o Malla Ortogonal' de color amarillo (Caja Amarilla) pintada dentro de una intersecci√≥n?", opts: ["a) Zona de estacionamiento temporal.", "b) Zona donde est√° prohibido detenerse; no debe ingresar si no tiene espacio para salir de la intersecci√≥n (No bloquear cruce).", "c) Zona exclusiva para cruce de peatones en diagonal.", "d) Zona de parada para transporte p√∫blico."], a: 1, learn: "‚ùå **Malla:** No bloquear la intersecci√≥n." },
        { q: "2. Con su licencia Clase A Categor√≠a I, ¬øest√° autorizado a conducir una motocicleta (Categor√≠a L3)?", opts: ["a) S√≠, la A-I cubre todas las categor√≠as inferiores.", "b) S√≠, pero solo si la moto es autom√°tica.", "c) No, para eso requiere una licencia de Clase B.", "d) S√≠, siempre que sea de uso particular y no comercial."], a: 2, learn: "üèçÔ∏è **Motos:** Requieren licencia Clase B." },
        { q: "3. Seg√∫n el Reglamento Nacional de Veh√≠culos, ¬øa partir de qu√© a√±o de antig√ºedad (contado desde el a√±o de fabricaci√≥n) debe pasar la PRIMERA Inspecci√≥n T√©cnica Vehicular un auto particular (M1)?", opts: ["a) Inmediatamente al salir de la tienda.", "b) A partir del 2do a√±o.", "c) A partir del 4to a√±o.", "d) A partir del 3er a√±o."], a: 2, learn: "üÜï **CITV:** Desde el 4to a√±o." },
        { q: "4. Usted llega a una intersecci√≥n no semaforizada al mismo tiempo que otro veh√≠culo que se aproxima por su derecha. ¬øQui√©n tiene la preferencia de paso?", opts: ["a) Usted, porque viene por la izquierda.", "b) El veh√≠culo que va m√°s r√°pido.", "c) El veh√≠culo que se aproxima por la derecha.", "d) El veh√≠culo m√°s grande."], a: 2, learn: "üëâ **Derecha:** Tiene la preferencia." },
        { q: "5. En una autopista o carretera, ¬øcu√°l es la funci√≥n del carril de aceleraci√≥n?", opts: ["a) Es para estacionarse en caso de emergencia.", "b) Permitir que el veh√≠culo aumente su velocidad para incorporarse al flujo de la v√≠a principal de manera segura.", "c) Es exclusivo para veh√≠culos de emergencia.", "d) Es para adelantar a camiones lentos."], a: 1, learn: "üöÄ **Aceleraci√≥n:** Para incorporarse a la velocidad de la v√≠a." },
        { q: "6. Seg√∫n el Cuadro de Infracciones, conducir un veh√≠culo con la licencia vencida (M.40) se sanciona con:", opts: ["a) Solo una amonestaci√≥n verbal si es menos de un mes.", "b) Multa (5% UIT) + Retenci√≥n del veh√≠culo (la licencia no es v√°lida).", "c) Cancelaci√≥n definitiva de la licencia.", "d) No hay sanci√≥n si se revalida al d√≠a siguiente."], a: 1, learn: "üö´ **Vencida:** Multa y retenci√≥n." },
        { q: "7. ¬øCu√°l es el l√≠mite m√°ximo de velocidad para un autom√≥vil (A-I) en carreteras, salvo se√±alizaci√≥n en contrario?", opts: ["a) 80 km/h.", "b) 90 km/h.", "c) 100 km/h.", "d) 120 km/h."], a: 2, learn: "üõ£Ô∏è **Carretera:** 100 km/h." },
        { q: "8. Si un Polic√≠a de Tr√°nsito le indica con la mano que avance (pase), pero el sem√°foro est√° en ROJO, ¬øqu√© debe hacer?", opts: ["a) Detenerse, porque el sem√°foro manda.", "b) Obedecer al Polic√≠a y avanzar (la orden del efectivo prevalece sobre las se√±ales).", "c) Esperar a que el sem√°foro cambie a verde para no confundir a otros.", "d) Preguntarle al polic√≠a si est√° seguro."], a: 1, learn: "üëÆ **Polic√≠a:** Prevalece sobre el sem√°foro." },
        { q: "9. Seg√∫n el Reglamento de Licencias (DS 007-2016-MTC), ¬øcu√°l es la vigencia del Certificado de Salud para el tr√°mite de obtenci√≥n de licencia (una vez emitido, cu√°nto tiempo vale para hacer el tr√°mite)?", opts: ["a) 15 d√≠as.", "b) 6 meses.", "c) 1 a√±o.", "d) Indefinido."], a: 1, learn: "ü©∫ **Salud:** 6 meses." },
        { q: "10. ¬øA qu√© distancia m√≠nima de un grifo (estaci√≥n de bomberos) o hidrante est√° prohibido estacionar?", opts: ["a) 1 metro.", "b) 3 metros.", "c) 5 metros.", "d) 10 metros."], a: 2, learn: "üöí **Hidrante:** 5 metros." },
        { q: "11. ¬øQu√© significan las l√≠neas blancas discontinuas (segmentadas) en la calzada?", opts: ["a) Que est√° prohibido adelantar.", "b) Que los carriles van en sentidos opuestos.", "c) Que se permite cruzar la l√≠nea para adelantar o cambiar de carril si es seguro.", "d) Que es una zona de estacionamiento."], a: 2, learn: "‚ö™ **Discontinua:** Permite cambio de carril." },
        { q: "12. En el contexto del SOAT, si ocurre un accidente y el veh√≠culo se da a la fuga sin ser identificado, ¬øqui√©n cubre los gastos m√©dicos de las v√≠ctimas peatones?", opts: ["a) Nadie, quedan desprotegidos.", "b) El Ministerio de Salud (SIS).", "c) El Fondo de Compensaci√≥n del SOAT (administrado por el MTC).", "d) La Municipalidad del distrito."], a: 2, learn: "üè• **Fuga:** Cubre el Fondo de Compensaci√≥n." },
        { q: "13. Seg√∫n el RNV, ¬øcu√°l es la profundidad m√≠nima del surco de la llanta para un auto particular para garantizar adherencia (evitar el hidroplaneo)?", opts: ["a) 0.5 mm.", "b) 1.6 mm.", "c) 3.0 mm.", "d) 5.0 mm."], a: 1, learn: "üìè **Llanta:** 1.6 mm." },
        { q: "14. ¬øEst√° permitido el uso de luces neblineras en la ciudad cuando no hay niebla ni lluvia intensa?", opts: ["a) S√≠, mejoran la est√©tica del auto.", "b) S√≠, ayudan a ver mejor los baches.", "c) No, est√° prohibido porque deslumbran innecesariamente a otros conductores.", "d) S√≠, pero solo las traseras."], a: 2, learn: "üí° **Neblineros:** Prohibidos sin niebla." },
        { q: "15. Si usted conduce en una v√≠a de doble sentido y se encuentra con un veh√≠culo averiado en su carril, ¬øpuede cruzar la l√≠nea central continua para adelantarlo?", opts: ["a) No, nunca se puede cruzar una l√≠nea continua. Debe esperar a que lo arreglen.", "b) S√≠, excepcionalmente, previa verificaci√≥n de seguridad y se√±alizando, para rebasar un obst√°culo inm√≥vil.", "c) S√≠, pero debe hacerlo a alta velocidad.", "d) Solo si un polic√≠a se lo ordena."], a: 1, learn: "‚ö†Ô∏è **Excepci√≥n:** Permitido con precauci√≥n." },
        { q: "16. ¬øCu√°ntos puntos se pierden por una infracci√≥n 'Leve' en el Sistema de Control de Licencias?", opts: ["a) 1 a 20 puntos.", "b) 30 puntos.", "c) 50 puntos.", "d) No restan puntos, solo es multa pecuniaria."], a: 0, learn: "üìâ **Leve:** 1 a 20 puntos." },
        { q: "17. ¬øQu√© documento debe presentar obligatoriamente si la polic√≠a lo detiene, que acredite que el veh√≠culo est√° apto mec√°nicamente (si el auto tiene la antig√ºedad requerida)?", opts: ["a) La factura de mantenimiento del taller.", "b) El Certificado de Inspecci√≥n T√©cnica Vehicular (CITV) vigente.", "c) La tarjeta de propiedad.", "d) El manual de usuario."], a: 1, learn: "üîß **CITV:** Acredita estado mec√°nico." },
        { q: "18. En una pendiente (bajada) pronunciada, ¬øes correcto poner la caja de cambios en 'Neutro' para ahorrar combustible?", opts: ["a) S√≠, es una t√©cnica de ahorro recomendada.", "b) No, est√° prohibido y es peligroso porque se pierde el control y el frenado de motor.", "c) S√≠, pero manteniendo el pie en el freno.", "d) Solo si la bajada es recta."], a: 1, learn: "üõë **Neutro:** Peligroso y prohibido en bajada." },
        { q: "19. ¬øQu√© indica la se√±al vertical de tr√°nsito de color MARR√ìN?", opts: ["a) Zona Arqueol√≥gica o Tur√≠stica.", "b) Zona escolar.", "c) Servicio mec√°nico cercano.", "d) Destino en carretera."], a: 0, learn: "üè∫ **Marr√≥n:** Turismo." },
        { q: "20. Si su licencia A-I tiene la restricci√≥n 'Uso de lentes correctores', y la polic√≠a lo interviene conduciendo sin ellos:", opts: ["a) No pasa nada si demuestra que ve bien.", "b) Es una infracci√≥n, pero solo educativa.", "c) Es una infracci√≥n Grave (G.19) por conducir veh√≠culo sin cumplir las restricciones de la licencia (Multa + Puntos).", "d) Solo le piden que se los ponga."], a: 2, learn: "üëì **Lentes:** Falta Grave." },
        { q: "21. Explique en qu√© consiste la demarcaci√≥n en el pavimento denominada 'No bloquear cruce' (Malla Ortogonal), de qu√© color es y qu√© obligaci√≥n impone al conductor, incluso si el sem√°foro se encuentra en luz verde.", type: "TEXT", key: ["malla", "amarillo", "bloquear", "detener"], learn: "‚ùå **Malla:** No detenerse dentro del cruce." },
        { q: "22. De acuerdo con el Reglamento de Licencias de Conducir, la vigencia de la licencia Clase A Categor√≠a I es de 10 a√±os. Sin embargo, al momento de la revalidaci√≥n, este plazo puede variar seg√∫n el r√©cord del conductor. Detalle cu√°les son los tres plazos de vigencia posibles y de qu√© dependen.", type: "TEXT", key: ["10", "8", "5"], learn: "üìÖ **Plazos:** 10, 8 o 5 a√±os seg√∫n r√©cord." },
        { q: "23. Si un propietario decide modificar el sistema de combusti√≥n de su veh√≠culo particular (por ejemplo, convertirlo a GNV o GLP), ¬øqu√© documento t√©cnico espec√≠fico se requiere para inscribir este cambio en el Registro de Propiedad Vehicular y actualizar la Tarjeta de Identificaci√≥n Vehicular? (Oral)", type: "AUDIO", key: ["conformidad", "certificado"], learn: "üìù **Gas:** Certificado de Conformidad." },
        { q: "24. Describa la funci√≥n y la ubicaci√≥n de la se√±al preventiva P-61, conocida como 'Delineador de Curva Horizontal' o 'Chevron'. (Oral)", type: "AUDIO", key: ["curva", "guiar"], learn: "‚Ü©Ô∏è **Chevron:** Delinear curvas peligrosas." }
    ],
    'C1': [
        { q: "1. Seg√∫n el Reglamento de Licencias de Conducir, ¬øcu√°l es la edad m√°xima para ser titular de una licencia de conducir de categor√≠a profesional?", opts: ["a) 70 a√±os.", "b) 75 a√±os.", "c) 65 a√±os.", "d) No existe l√≠mite, solo evaluaciones m√©dicas m√°s frecuentes.", "e) 80 a√±os."], a: 4, learn: "üë¥ **Edad:** 80 a√±os m√°ximo." },
        { q: "2. De acuerdo al Reglamento Nacional de Veh√≠culos (RNV), ¬øcu√°l es la tolerancia permitida en el control de peso por eje o conjunto de ejes en el pesaje din√°mico?", opts: ["a) 5%.", "b) 3%.", "c) 8%.", "d) 10%.", "e) No existe tolerancia para el peso por eje, solo para el peso bruto."], a: 1, learn: "‚öñÔ∏è **Pesaje:** 3% de tolerancia." },
        { q: "3. En el Manual de Dispositivos de Control del Tr√°nsito, ¬øqu√© color de fondo se utiliza para las se√±ales informativas de lugares de inter√©s tur√≠stico, arqueol√≥gico e hist√≥rico?", opts: ["a) Azul.", "b) Verde.", "c) Blanco.", "d) Marr√≥n (Caf√©).", "e) Naranja."], a: 3, learn: "üè∫ **Turismo:** Fondo Marr√≥n." },
        { q: "4. Seg√∫n el Reglamento Nacional de Administraci√≥n de Transporte (RENAT), ¬øcu√°l es la jornada m√°xima de conducci√≥n continua permitida en el servicio nocturno?", opts: ["a) 5 horas.", "b) 4 horas.", "c) 6 horas.", "d) 3 horas.", "e) 10 horas acumuladas."], a: 1, learn: "üåô **Nocturno:** M√°ximo 4 horas." },
        { q: "5. Seg√∫n el RNV, ¬øcu√°l es la longitud m√°xima permitida para un √≥mnibus de 2 ejes (C2) o 3 ejes (C3)?", opts: ["a) 12.00 m.", "b) 14.00 m.", "c) 13.20 m.", "d) 15.00 m.", "e) 12.60 m."], a: 2, learn: "üöå **Largo:** 13.20 metros." },
        { q: "6. Si un conductor con Licencia A-IIb ha sido sancionado por una infracci√≥n 'Muy Grave' que amerit√≥ la suspensi√≥n de su licencia, ¬øcu√°l ser√° la vigencia de su licencia al revalidarla?", opts: ["a) 3 a√±os.", "b) 5 a√±os.", "c) 4 a√±os.", "d) 1 a√±o.", "e) 2 a√±os."], a: 4, learn: "üìâ **Sanci√≥n:** 2 a√±os de vigencia." },
        { q: "7. Seg√∫n el Manual de Dispositivos, la se√±al preventiva P-49 'Zona Escolar' tiene una forma y color particular. ¬øCu√°l es?", opts: ["a) Pentagonal con fondo amarillo lim√≥n fluorescente.", "b) Romboidal con fondo amarillo convencional.", "c) Rectangular con fondo blanco.", "d) Circular con borde rojo.", "e) Romboidal con fondo naranja."], a: 0, learn: "üè´ **Escolar:** Pent√°gono Amarillo Lim√≥n." },
        { q: "8. De acuerdo con el RENAT, ¬øcu√°l es la definici√≥n t√©cnica de un '√Årea Saturada'?", opts: ["a) Zona donde hay muchos paraderos informales.", "b) Parte del territorio donde la velocidad promedio es menor a 10km/h.", "c) V√≠a donde circulan m√°s de 1000 veh√≠culos por hora.", "d) Parte del territorio con niveles de contaminaci√≥n o congesti√≥n que comprometen la calidad de vida, declarada as√≠ por la municipalidad provincial.", "e) Zona comercial con alta afluencia peatonal."], a: 3, learn: "üå´Ô∏è **Saturada:** Por contaminaci√≥n o congesti√≥n." },
        { q: "9. Seg√∫n la clasificaci√≥n vehicular del RNV, ¬øqu√© define a la Categor√≠a O4?", opts: ["a) Remolques con peso bruto de hasta 0.75 toneladas.", "b) Remolques con peso bruto vehicular de m√°s de 10 toneladas.", "c) Veh√≠culos de 4 ruedas para transporte de pasajeros.", "d) Veh√≠culos de carga con peso bruto mayor a 12 toneladas.", "e) Remolques con peso bruto de m√°s de 3.5 hasta 10 toneladas."], a: 1, learn: "üöõ **O4:** Remolque > 10 toneladas." },
        { q: "10. En el Manual de Dispositivos, ¬øcu√°l es el significado de una l√≠nea central amarilla continua doble?", opts: ["a) Separaci√≥n de carriles en el mismo sentido.", "b) Zona de adelantamiento permitido con precauci√≥n.", "c) Separaci√≥n de flujos opuestos donde est√° prohibido adelantar en ambos sentidos (barrera imaginaria).", "d) Carril reversible.", "e) Borde de calzada donde est√° prohibido estacionar."], a: 2, learn: "üöß **Doble Amarilla:** Muro virtual, prohibido cruzar." },
        { q: "11. Seg√∫n el Reglamento de Licencias, ¬øqu√© autoridad es la competente para conducir el procedimiento de emisi√≥n y entrega de las licencias de conducir de Clase B (motos/mototaxis)?", opts: ["a) El Ministerio de Transportes y Comunicaciones (MTC).", "b) El Gobierno Regional.", "c) La Polic√≠a Nacional del Per√∫.", "d) El Touring y Autom√≥vil Club del Per√∫.", "e) La Municipalidad Provincial."], a: 4, learn: "üõµ **Motos:** Municipalidad Provincial." },
        { q: "12. De acuerdo al Anexo III del RNV, ¬øcu√°l es la profundidad m√≠nima de las ranuras principales de los neum√°ticos para un veh√≠culo de categor√≠a M3 o N3?", opts: ["a) 2.0 mm.", "b) 1.6 mm.", "c) 3.0 mm.", "d) 1.0 mm.", "e) 1.5 mm."], a: 0, learn: "üöö **Pesados:** 2.0 mm." },
        { q: "13. Seg√∫n el RENAT, ¬øcu√°l es el √°mbito territorial autorizado para prestar el 'Servicio de Transporte Especial de Personas en Auto Colectivo'?", opts: ["a) √Åmbito Nacional (entre cualquier regi√≥n del pa√≠s).", "b) √Åmbito Provincial exclusivamente.", "c) √Åmbito Distrital.", "d) √Åmbito Regional (dentro de una regi√≥n).", "e) √Åmbito Internacional lim√≠trofe."], a: 3, learn: "üöó **Colectivo:** Regional." },
        { q: "14. Seg√∫n la Tabla 2.4 del Manual de Dispositivos, para una v√≠a con velocidad m√°xima de 90 a 120 km/h, ¬øcu√°l es la altura m√≠nima de la letra may√∫scula en una leyenda simple de una se√±al informativa?", opts: ["a) 15.0 cm.", "b) 25.0 cm.", "c) 20.0 cm.", "d) 30.0 cm.", "e) 35.0 cm."], a: 1, learn: "üìè **Letra:** 25 cm." },
        { q: "15. ¬øCu√°l es la vigencia del certificado de salud para licencias de conducir una vez que ha sido registrado en el Sistema Nacional de Conductores?", opts: ["a) 1 a√±o.", "b) 3 meses.", "c) 6 meses.", "d) 30 d√≠as.", "e) Indefinida hasta que se use."], a: 2, learn: "ü©∫ **Salud:** 6 meses." },
        { q: "16. Seg√∫n el RNV, el ancho m√°ximo permitido para un veh√≠culo (incluyendo la carga, pero sin espejos) es de:", opts: ["a) 2.40 m.", "b) 2.50 m.", "c) 2.80 m.", "d) 3.00 m.", "e) 2.60 m."], a: 4, learn: "üìê **Ancho:** 2.60 metros." },
        { q: "17. En las se√±ales informativas de servicios auxiliares (fondo azul), ¬øde qu√© color debe ser el recuadro que contiene el s√≠mbolo?", opts: ["a) Blanco.", "b) Negro.", "c) Amarillo.", "d) Rojo.", "e) No lleva recuadro."], a: 0, learn: "‚õΩ **Se√±al Azul:** Recuadro Blanco." },
        { q: "18. El Reglamento de Licencias permite obtener la licencia A-I a partir de los 16 a√±os, ¬øbajo qu√© condici√≥n espec√≠fica?", opts: ["a) Con autorizaci√≥n notarial de ambos padres.", "b) Si estudia mec√°nica automotriz.", "c) Si posee un veh√≠culo propio registrado a su nombre.", "d) Si tiene plena capacidad de sus derechos civiles (casado o con t√≠tulo oficial).", "e) Solo para conducir veh√≠culos autom√°ticos."], a: 3, learn: "üíç **16 a√±os:** Capacidad plena (casado/t√≠tulo)." },
        { q: "19. Seg√∫n el RNV, ¬øcu√°l es el m√≠nimo de la relaci√≥n potencia/peso bruto combinado para los veh√≠culos de las categor√≠as M3 y N3?", opts: ["a) 5.5 kW/t.", "b) 4.85 kW/t.", "c) 6.0 kW/t.", "d) 4.0 kW/t.", "e) 7.2 kW/t."], a: 1, learn: "‚ö° **Potencia:** 4.85 kW/t." },
        { q: "20. Si un conductor con licencia Clase A Categor√≠a I es sancionado por una infracci√≥n Muy Grave que amerita la suspensi√≥n de la licencia, al revalidarla, la nueva vigencia ser√° de:", opts: ["a) 2 a√±os.", "b) 10 a√±os.", "c) 5 a√±os.", "d) 8 a√±os.", "e) 3 a√±os."], a: 2, learn: "üìâ **Vigencia:** 5 a√±os." },
        { q: "21. Seg√∫n el Manual de Dispositivos, ¬øcu√°l es el c√≥digo de la se√±al preventiva 'Delineador de Curva Horizontal' (conocida como Chevron)?", opts: ["a) P-1A.", "b) P-60.", "c) P-58.", "d) P-33.", "e) P-61."], a: 4, learn: "‚Ü©Ô∏è **Chevron:** P-61." },
        { q: "22. Seg√∫n el RENAT, si un veh√≠culo habilitado para el transporte de personas no cuenta con SOAT vigente al momento de una intervenci√≥n, la autoridad aplica la medida preventiva de:", opts: ["a) Retenci√≥n del veh√≠culo.", "b) Solo multa pecuniaria.", "c) Suspensi√≥n de la habilitaci√≥n vehicular por 1 a√±o.", "d) Interrupci√≥n del viaje.", "e) Remoci√≥n del veh√≠culo."], a: 0, learn: "üõë **Sin SOAT:** Retenci√≥n." },
        { q: "23. De acuerdo con el RNV (Definiciones), una 'M√°quina Amarilla' (equipo para construcci√≥n/miner√≠a):", opts: ["a) Es un veh√≠culo especial categor√≠a S.", "b) Requiere placa de rodaje para circular por la carretera.", "c) Es un veh√≠culo categor√≠a N3.", "d) No se considera veh√≠culo especial ni est√° destinado a circular dentro del Sistema Nacional de Transporte Terrestre (SNTT).", "e) Puede circular libremente si tiene luces giratorias."], a: 3, learn: "üöú **M√°quina:** No es veh√≠culo SNTT." },
        { q: "24. Seg√∫n el Manual de Dispositivos, la se√±al reglamentaria R-1 (PARE) debe colocarse como m√≠nimo a qu√© distancia del inicio de la v√≠a interceptada (en zona rural)?", opts: ["a) 1 metro.", "b) 2 metros.", "c) 3 metros.", "d) 5 metros.", "e) 0.5 metros."], a: 1, learn: "üëÄ **Rural:** 2 metros." },
        { q: "25. Para recategorizar a la Licencia de Conducir Clase A Categor√≠a II-B, ¬øqu√© antig√ºedad se requiere con la licencia anterior?", opts: ["a) 2 a√±os con la A-I o 1 a√±o con la A-IIa.", "b) 1 a√±o con la A-I.", "c) 3 a√±os con la A-I o 1 a√±o con la A-IIa.", "d) 4 a√±os con la A-I.", "e) No se requiere antig√ºedad, solo examen."], a: 2, learn: "üìÖ **A-IIb:** 3 a√±os con A-I." },
        { q: "26. Seg√∫n el Anexo III del RNV, ¬øqu√© categor√≠as de veh√≠culos deben contar obligatoriamente con l√°minas retrorreflectivas?", opts: ["a) Solo N3 y O4.", "b) Solo M3 y N3.", "c) M1 (Taxi), M2, M3, N y O.", "d) Todos los veh√≠culos motorizados.", "e) M2, M3 y N."], a: 4, learn: "‚ú® **Cintas:** M2, M3 y N." },
        { q: "27. ¬øCu√°l es el c√≥digo y significado de la se√±al R-50 en el Manual de Dispositivos?", opts: ["a) Preferencia al sentido contrario.", "b) Mantener distancia de seguridad.", "c) No bloquear cruce.", "d) Ceda el paso.", "e) Solo buses."], a: 2, learn: "‚ùå **R-50:** No bloquear cruce." },
        { q: "28. De acuerdo con el RENAT, el manifiesto de usuarios impreso en el transporte de personas debe ser conservado por el transportista por un plazo de:", opts: ["a) 1 a√±o.", "b) 30 d√≠as.", "c) 60 d√≠as.", "d) 90 d√≠as.", "e) 5 a√±os."], a: 1, learn: "üìÇ **Manifiesto:** 30 d√≠as." },
        { q: "29. De acuerdo con el Reglamento Nacional del Sistema de Emisi√≥n de Licencias de Conducir, describa detalladamente el procedimiento administrativo y las consecuencias inmediatas si la Polic√≠a Nacional del Per√∫ (PNP) interviene a un conductor que presenta una discapacidad f√≠sica evidente que no figura como restricci√≥n en su licencia de conducir. ¬øQu√© sucede con la licencia en ese momento y qu√© debe hacer la autoridad competente posteriormente? (Oral)", type: "AUDIO", key: ["reexaminaci√≥n", "retener", "evaluaci√≥n"], learn: "Retenci√≥n inmediata y reexaminaci√≥n m√©dica." },
        { q: "30. Seg√∫n el Anexo III del Reglamento Nacional de Veh√≠culos (RNV), detalle las especificaciones t√©cnicas obligatorias para la instalaci√≥n de l√°minas retrorreflectivas en los veh√≠culos de las categor√≠as M, N y O. Espec√≠ficamente, indique: los colores permitidos, la orientaci√≥n de fijaci√≥n y la altura m√≠nima y m√°xima de colocaci√≥n respecto a la superficie de la carretera. (Oral)", type: "AUDIO", key: ["rojo", "blanco", "lateral", "posterior"], learn: "Rojo/Blanco, lateral/posterior, entre 300mm y 1.60m." },
        { q: "31. En el contexto del Manual de Dispositivos de Control del Tr√°nsito, para establecer legal y t√©cnicamente una zona de 'Prohibido Adelantar' en una carretera pavimentada de doble sentido, ¬øqu√© combinaci√≥n espec√≠fica de se√±alizaci√≥n vertical (reglamentaria y preventiva) y se√±alizaci√≥n horizontal (marcas en el pavimento) se debe implementar obligatoriamente? (Oral)", type: "AUDIO", key: ["continua", "banderola", "R-16", "P-60"], learn: "R-16, P-60 y L√≠nea Continua." }
    ],
    'C2': [
        { q: "1. Seg√∫n el Reglamento de Licencias de Conducir, si un conductor de 76 a√±os desea revalidar su licencia Clase A Categor√≠a I, ¬øpor qu√© periodo de vigencia se le otorgar√° la licencia, asumiendo que aprueba el examen m√©dico?", opts: ["a) 1 a√±o.", "b) 5 a√±os.", "c) 2 a√±os.", "d) 3 a√±os.", "e) 6 meses."], a: 0, learn: "üë¥ **76 a√±os:** 1 a√±o." },
        { q: "2. En el Manual de Dispositivos de Control del Tr√°nsito, la se√±al preventiva P-61 'Delineador de Curva Horizontal' (conocida como Chevron) tiene una caracter√≠stica √∫nica respecto a su forma. ¬øCu√°l es?", opts: ["a) Es la √∫nica se√±al preventiva de forma circular.", "b) Es de forma cuadrada con diagonal vertical (rombo), igual que todas las preventivas.", "c) Es de forma rectangular, con su mayor dimensi√≥n en el lado vertical.", "d) Es de forma triangular con el v√©rtice hacia la derecha.", "e) Es de forma pentagonal."], a: 2, learn: "üõë **Chevron:** Rectangular." },
        { q: "3. De acuerdo con el Anexo IV del Reglamento Nacional de Veh√≠culos, ¬øcu√°l es la tolerancia de peso permitida para el Peso Bruto Vehicular en el pesaje din√°mico?", opts: ["a) 5%.", "b) 2%.", "c) 8%.", "d) No existe tolerancia para el peso bruto, solo por eje.", "e) 3%."], a: 4, learn: "‚öñÔ∏è **Tolerancia:** 3%." },
        { q: "4. Seg√∫n el RENAT, en el servicio de transporte de personas, la jornada m√°xima de conducci√≥n continua en el turno diurno es de 5 horas. ¬øCu√°l es la jornada m√°xima continua permitida en el turno nocturno?", opts: ["a) 3 horas y 30 minutos.", "b) 5 horas (igual que en el d√≠a).", "c) 4 horas y 30 minutos.", "d) 4 horas.", "e) 6 horas, si hay copiloto."], a: 3, learn: "üåô **Nocturna:** 4 horas." },
        { q: "5. Seg√∫n el Manual de Dispositivos, ¬øqu√© color de fondo espec√≠fico se debe utilizar para las se√±ales preventivas en zonas escolares (P-49)?", opts: ["a) Amarillo convencional.", "b) Naranja fluorescente.", "c) Amarillo Lim√≥n Fluorescente (Amarillo-Verde).", "d) Blanco con borde rojo.", "e) Azul."], a: 2, learn: "üè´ **Fondo:** Amarillo Lim√≥n." },
        { q: "6. Seg√∫n el Reglamento de Licencias, para obtener por recategorizaci√≥n la Licencia Clase A Categor√≠a III-A, ¬øqu√© requisito de experiencia previa es indispensable?", opts: ["a) Tener Licencia A-I por 3 a√±os.", "b) Tener Licencia A-IIb por un m√≠nimo de 2 a√±os.", "c) Tener Licencia A-IIa por un m√≠nimo de 2 a√±os.", "d) Tener Licencia A-IIb por un m√≠nimo de 1 a√±o.", "e) Tener Licencia A-I por 4 a√±os."], a: 1, learn: "üìà **A-IIIa:** 2 a√±os con A-IIb." },
        { q: "7. El Reglamento Nacional de Veh√≠culos establece que los veh√≠culos de categor√≠a M1 (autom√≥viles) deben contar con parachoques delantero y posterior. ¬øCu√°l es la condici√≥n t√©cnica espec√≠fica sobre sus bordes?", opts: ["a) Deben ser cromados para mejor visibilidad.", "b) Deben tener refuerzos de acero externos.", "c) No deben tener filos angulares cortantes ni exceder el ancho del veh√≠culo.", "d) Deben estar a una altura m√≠nima de 60 cm del suelo.", "e) Deben ser de material flexible obligatoriamente."], a: 2, learn: "üî™ **Parachoques:** Sin filos." },
        { q: "8. Si usted observa una se√±al vertical de reglamentaci√≥n R-14A (flecha blanca horizontal sobre fondo negro), ¬øqu√© le indica exactamente?", opts: ["a) Que la v√≠a es de doble sentido.", "b) Que est√° obligado a voltear en esa direcci√≥n.", "c) Sentido de tr√°nsito (Tr√°nsito en un sentido).", "d) Inicio de autopista.", "e) Calle sin salida."], a: 2, learn: "‚¨ÖÔ∏è **Sentido:** Un solo sentido." },
        { q: "9. Seg√∫n el RENAT, se considera 'Abandono del Servicio' en el transporte p√∫blico si el transportista deja de prestar el servicio sin causa justificada durante:", opts: ["a) 5 d√≠as consecutivos.", "b) 3 d√≠as consecutivos en servicios diarios.", "c) 15 d√≠as calendario alternados.", "d) 24 horas sin aviso.", "e) 10 d√≠as consecutivos o no, en un periodo de 30 d√≠as calendario."], a: 4, learn: "üöå **Abandono:** 10 d√≠as." },
        { q: "10. Seg√∫n el Anexo III del RNV, ¬øcu√°l es la profundidad m√≠nima de las ranuras principales de la banda de rodamiento de los neum√°ticos para un veh√≠culo de categor√≠a N3 (cami√≥n pesado)?", opts: ["a) 1.6 mm.", "b) 1.0 mm.", "c) 3.0 mm.", "d) 2.0 mm.", "e) 4.0 mm."], a: 3, learn: "üöö **N3:** 2.0 mm." },
        { q: "11. En una se√±al informativa de destino en carretera, si la altura de la letra may√∫scula es de 20 cm, ¬øqu√© tipo de alfabeto (serie) se recomienda utilizar para mejorar la legibilidad?", opts: ["a) Serie A.", "b) Serie B.", "c) Serie E (o en casos especiales otras series justificadas).", "d) Serie C.", "e) Times New Roman."], a: 2, learn: "üî§ **Letra:** Serie E." },
        { q: "12. Seg√∫n el Reglamento de Licencias, ¬øcu√°l es la vigencia de la Licencia Clase A Categor√≠a I para un conductor que ha sido sancionado por una infracci√≥n Leve en el periodo precedente a la revalidaci√≥n?", opts: ["a) 5 a√±os.", "b) 8 a√±os.", "c) 10 a√±os (siempre que haya cumplido con la sanci√≥n).", "d) 2 a√±os.", "e) 3 a√±os."], a: 1, learn: "üìÜ **Leve:** 8 a√±os." },
        { q: "13. ¬øQu√© indica la se√±al preventiva P-60 (Tri√°ngulo is√≥sceles con la punta hacia la izquierda y la leyenda 'NO ADELANTAR') seg√∫n el Manual de Dispositivos?", opts: ["a) Fin de la zona de prohibici√≥n de adelantamiento.", "b) Advierte que no se debe adelantar en el tramo (zona de no adelantar).", "c) Que se aproxima un cruce a la izquierda.", "d) Que la v√≠a se estrecha a la izquierda.", "e) Que es una zona de derrumbes."], a: 1, learn: "üö´ **P-60:** No adelantar." },
        { q: "14. Seg√∫n el RNV, para la nacionalizaci√≥n de motores usados remanufacturados, ¬øqu√© requisito adicional de identificaci√≥n se exige en la factura comercial?", opts: ["a) El a√±o de fabricaci√≥n del motor.", "b) La potencia en kW.", "c) El n√∫mero de motor estampado y/o grabado.", "d) El kilometraje del motor.", "e) El color del bloque del motor."], a: 2, learn: "üî¢ **Motor:** N√∫mero estampado." },
        { q: "15. De acuerdo al RENAT, si un veh√≠culo cuenta con dos conductores para el servicio interprovincial, ¬øcu√°l es la duraci√≥n acumulada m√°xima de conducci√≥n permitida en un periodo de 24 horas para cada conductor?", opts: ["a) 8 horas.", "b) 12 horas.", "c) 14 horas.", "d) 10 horas.", "e) 9 horas."], a: 1, learn: "‚è±Ô∏è **2 Choferes:** 12 horas." },
        { q: "16. En el Manual de Dispositivos, la se√±al R-30F (Velocidad M√°xima en Curva) tiene una diferencia de color respecto a las dem√°s se√±ales de velocidad (R-30). ¬øCu√°l es?", opts: ["a) Fondo blanco y n√∫meros rojos.", "b) Fondo amarillo fluorescente.", "c) Fondo amarillo, orla roja y n√∫meros negros.", "d) Fondo naranja.", "e) Fondo azul."], a: 2, learn: "‚ö†Ô∏è **Curva:** Fondo amarillo." },
        { q: "17. Seg√∫n el Reglamento de Licencias, ¬øcu√°l es la edad m√≠nima para obtener directamente (sin recategorizaci√≥n) una Licencia Clase B Categor√≠a II-C (para mototaxis)?", opts: ["a) 21 a√±os.", "b) 16 a√±os.", "c) 20 a√±os.", "d) 18 a√±os.", "e) 23 a√±os."], a: 3, learn: "üõ∫ **Edad:** 18 a√±os." },
        { q: "18. Seg√∫n el RNV, los veh√≠culos de categor√≠a M3 (buses) deben contar obligatoriamente con un dispositivo espec√≠fico para el control de la operaci√≥n. ¬øCu√°l es?", opts: ["a) GPS con pantalla para el usuario.", "b) Tac√≥grafo o dispositivo electr√≥nico registrador de tiempo y velocidad.", "c) Radio de comunicaci√≥n UHF.", "d) C√°mara de retroceso.", "e) Sensor de proximidad."], a: 1, learn: "üìº **M3:** Tac√≥grafo." },
        { q: "19. ¬øQu√© significa la se√±al vertical I-28 del Manual de Dispositivos (Rect√°ngulo azul con una ola blanca)?", opts: ["a) Zona de Playa.", "b) Balneario.", "c) Peligro de inundaci√≥n.", "d) Zona de Riesgo por Tsunami.", "e) Puerto."], a: 3, learn: "üåä **I-28:** Tsunami." },
        { q: "20. Si un conductor de 72 a√±os de edad con licencia profesional A-IIIa desea revalidarla, ¬øcu√°l ser√° el periodo de vigencia de su nueva licencia seg√∫n el Reglamento de Licencias?", opts: ["a) 5 a√±os.", "b) 1 a√±o.", "c) 2 a√±os.", "d) 3 a√±os.", "e) 6 meses."], a: 1, learn: "üë¥ **72 a√±os:** 1 a√±o." },
        { q: "21. Limitador de velocidad nacional:", opts: ["90 km/h.", "100 km/h.", "80 km/h.", "120 km/h.", "110 km/h."], a: 0, learn: "üöå **Limitador:** 90 km/h." },
        { q: "22. Ancho m√≠nimo L√≠nea de Pare:", opts: ["0.30 m.", "0.40 m.", "0.60 m.", "0.50 m.", "0.25 m."], a: 3, learn: "üìè **Pare:** 0.50 m." },
        { q: "23. Categor√≠a cuatriciclo carga (450kg):", opts: ["L5.", "L7.", "L6.", "M1.", "N1."], a: 1, learn: "üöú **Cuatriciclo:** L7." },
        { q: "24. Licencia tras ebriedad + accidente:", opts: ["3 a√±os.", "Nunca (Definitiva).", "5 a√±os.", "10 a√±os.", "1 a√±o."], a: 1, learn: "üç∑ **Sanci√≥n:** Cancelaci√≥n definitiva." },
        { q: "25. Se√±al R-58A:", opts: ["No bici.", "Compartida.", "Exclusiva.", "V√≠a segregada.", "Cruce."], a: 3, learn: "üö¥ **R-58A:** V√≠a segregada." },
        { q: "26. Exonerados antiempotramiento:", opts: ["N2.", "O3.", "Distancia <350mm.", "Cisternas.", "Volquetes."], a: 2, learn: "üìê **Exonerado:** <350mm altura." },
        { q: "27. Sanci√≥n Escuela fraude horas:", opts: ["1 UIT.", "Suspensi√≥n.", "15 UIT + Cancelaci√≥n.", "Amonestaci√≥n.", "5 UIT."], a: 2, learn: "üè´ **Fraude:** 15 UIT + Cancelaci√≥n." },
        { q: "28. Color cruz emergencia:", opts: ["Azul.", "Azul/Blanco/Roja.", "Blanco/Rojo.", "Verde.", "Rojo."], a: 1, learn: "üè• **Cruz:** Roja sobre blanco." },
        { q: "29. Antig√ºedad carga:", opts: ["15.", "20.", "30.", "10.", "No sujeto."], a: 4, learn: "üöõ **Antig√ºedad:** No sujeto." },
        { q: "30. L√≠nea ancha:", opts: ["No cambio.", "Borde.", "Continuidad.", "Est.", "Op."], a: 2, learn: "üõ£Ô∏è **L√≠nea Ancha:** Continuidad." },
        { q: "31. Bonif Susp (Oral):", type: "AUDIO", key: ["10", "5"], learn: "10% Eje, 5% PBV." },
        { q: "32. Rampa (Oral):", type: "AUDIO", key: ["rojo", "1000"], learn: "Roja, 1000m antes." },
        { q: "33. Susp Precautoria (Oral):", type: "AUDIO", key: ["30", "treinta"], learn: "30% de la flota." }
    ]
};

// ==========================================
// APP LOGIC
// ==========================================
const app = {
    cat: 'A-I',
    unlocked: 0,
    currCfg: null,
    qIdx: 0,
    score: 0,
    timer: null,
    timeLeft: 900, // 15 minutos

    config: [
        { id: 'A1', name: 'Nivel A1', min: 60, max: 100, mc: 5 },
        { id: 'A2', name: 'Nivel A2', min: 70, max: 120, mc: 5 },
        { id: 'B1', name: 'Nivel B1', min: 100, max: 140, mc: 6, open: 10 },
        { id: 'B2', name: 'Nivel B2', min: 120, max: 160, mc: 5, open: 15 },
        { id: 'C1', name: 'Nivel C1', min: 140, max: 170, mc: 5, open: 10 },
        { id: 'C2', name: 'Nivel C2', min: 150, max: 180, mc: 5, open: 10 }
    ],

    init: function() {
        const s = localStorage.getItem('drive_lvl');
        if(s) this.unlocked = parseInt(s);
        this.renderLvl();
        this.applyEffects();
    },

    applyEffects: function() {
        document.querySelectorAll('.spotlight').forEach(el => {
            el.onmousemove = e => {
                const rect = el.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                el.style.setProperty('--mouse-x', `${x}px`);
                el.style.setProperty('--mouse-y', `${y}px`);
            }
        });
    },

    reset: function() {
        this.stopTimer();
        localStorage.removeItem('drive_lvl');
        location.reload();
    },

    nav: function(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id !== 'v-game' && Game.state.run) Game.stop();
    },

    setCat: function(c, btn) {
        btn.classList.add('card-selected');
        setTimeout(() => {
            // L√≥gica corregida: Si es Mototaxi -> B-IIc, si es Auto -> A-I
            this.cat = c === 'B-IIc' ? 'B-IIc' : 'A-I';
            document.getElementById('cat-lbl').innerText = this.cat;
            this.renderLvl();
            this.nav('v-levels');
            btn.classList.remove('card-selected');
        }, 400);
    },

    renderLvl: function() {
        const c = document.getElementById('lvl-list');
        c.innerHTML = '';
        this.config.forEach((l, i) => {
            const u = i <= this.unlocked;
            const d = document.createElement('div');
            d.className = `lvl-row spotlight ${u ? 'unlocked' : 'locked'}`;
            d.innerHTML = `
                <div><strong>${l.name}</strong><br><small style="color:var(--text-dim)">M√≠nimo: ${l.min} pts</small></div>
                <div class="badge">${u ? 'ABIERTO' : 'üîí'}</div>
            `;
            if(u) d.onclick = () => this.start(i);
            c.appendChild(d);
        });
        this.applyEffects();
    },

    start: function(i) {
        const cfg = this.config[i];
        this.currCfg = { ...cfg, qs: DB[cfg.id] || DB['A1'] };
        this.nav('v-study');
        this.renderStudy();
    },

    renderStudy: function() {
        const c = document.getElementById('study-container');
        c.innerHTML = '';
        this.currCfg.qs.forEach((item) => {
            let cleanQuestion = item.q.replace(/^\d+\.\s*/, '');
            let teaching = item.learn ? item.learn : "üí° <em>Tip: Revisa el Reglamento Nacional de Tr√°nsito.</em>";
            const card = document.createElement('div');
            card.className = 'study-card';
            card.innerHTML = `<div class="study-q">${cleanQuestion}</div><div class="study-a">${teaching}</div>`;
            c.appendChild(card);
        });
    },

    startExam: function() {
        this.qIdx = 0;
        this.score = 0;
        this.nav('v-exam');
        this.renderQ();
        this.startTimer();
    },

    startTimer: function() {
        this.timeLeft = 900;
        this.updateTimerDisplay();
        const display = document.getElementById('timer-display');
        display.classList.add('active');
        display.classList.remove('danger');
        
        if(this.timer) clearInterval(this.timer);
        
        this.timer = setInterval(() => {
            this.timeLeft--;
            this.updateTimerDisplay();
            if(this.timeLeft < 60) display.classList.add('danger');
            if(this.timeLeft <= 0) {
                this.stopTimer();
                this.finish();
            }
        }, 1000);
    },

    stopTimer: function() {
        if(this.timer) clearInterval(this.timer);
        const display = document.getElementById('timer-display');
        display.classList.remove('active', 'danger');
    },

    updateTimerDisplay: function() {
        const m = Math.floor(this.timeLeft / 60);
        const s = this.timeLeft % 60;
        document.getElementById('timer-display').innerText = 
            `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    },

    renderQ: function() {
        const q = this.currCfg.qs[this.qIdx];
        const tot = this.currCfg.qs.length;
        document.getElementById('ex-name').innerText = this.currCfg.name;
        document.getElementById('ex-count').innerText = `${this.qIdx+1}/${tot}`;
        document.getElementById('bar').style.width = `${((this.qIdx)/tot)*100}%`;
        document.getElementById('q-text').innerText = q.q;

        const area = document.getElementById('q-area');
        area.innerHTML = '';

        if(q.type === 'TEXT') {
            area.innerHTML = `<textarea id="in-txt" placeholder="Escribe tu respuesta..."></textarea><button class="action-btn spotlight primary" onclick="app.ansText()">Enviar Respuesta</button>`;
        } else if(q.type === 'AUDIO') {
            area.innerHTML = `<div class="mic-btn" onclick="app.rec(this)">üé§</div><p id="rec-s" style="text-align:center;font-size:0.9rem;color:var(--text-dim)">Toca para grabar</p><input type="hidden" id="in-aud"><button id="b-aud" class="action-btn spotlight primary" style="display:none" onclick="app.ansAudio()">Enviar Respuesta</button>`;
        } else {
            q.opts.forEach((o, i) => {
                const b = document.createElement('button');
                b.className = 'opt-btn spotlight';
                b.innerText = o;
                b.onclick = () => app.ansMC(i);
                area.appendChild(b);
            });
        }
        this.applyEffects();
    },

    ansMC: function(i) {
        if(i === this.currCfg.qs[this.qIdx].a) this.score += this.currCfg.mc;
        this.next();
    },

    ansText: function() {
        const val = document.getElementById('in-txt').value.toLowerCase();
        this.scoreOpen(val);
    },

    rec: function(btn) {
        const s = document.getElementById('rec-s');
        btn.classList.add('recording');
        s.innerText = "Escuchando...";
        setTimeout(() => {
            btn.classList.remove('recording');
            s.innerText = "Grabaci√≥n finalizada";
            document.getElementById('b-aud').style.display = 'block';
            document.getElementById('in-aud').value = this.currCfg.qs[this.qIdx].key[0];
        }, 1500);
    },

    ansAudio: function() {
        this.scoreOpen(document.getElementById('in-aud').value);
    },

    scoreOpen: function(val) {
        let hits = 0;
        this.currCfg.qs[this.qIdx].key.forEach(k => { if(val.includes(k)) hits++; });
        // L√≥gica de puntaje parcial: 1 acierto da puntos parciales, 2 aciertos da puntos completos
        // Para las orales del B1/B2/C1 que valen 10 pts
        if(hits >= 1) {
            const pts = this.currCfg.open; // 10 o 15 pts
            const partial = (this.currCfg.id === 'B2' || this.currCfg.id === 'C1') ? 0.6 : 0.8;
            this.score += (hits >= 2 ? pts : (pts * partial));
        }
        this.next();
    },

    next: function() {
        if(this.qIdx < this.currCfg.qs.length - 1) { this.qIdx++; this.renderQ(); }
        else this.finish();
    },

    finish: function() {
        this.stopTimer();
        this.nav('v-result');
        if(this.score > this.currCfg.max) this.score = this.currCfg.max;
        this.score = Math.round(this.score);
        const pass = this.score >= this.currCfg.min;
        
        const val = document.getElementById('res-val');
        val.innerText = this.score;
        val.style.color = pass ? 'var(--success)' : 'var(--error)';
        
        document.getElementById('res-msg').innerText = pass ? "¬°FELICIDADES, APROBADO!" : `Necesitas m√≠nimo ${this.currCfg.min} pts para aprobar`;
        
        const cert = document.getElementById('cert');
        if(pass) {
            cert.style.display = 'block';
            document.getElementById('c-cat').innerText = this.cat;
            document.getElementById('c-lvl').innerText = this.currCfg.name;
            let n = "APROBADO";
            if(this.score === this.currCfg.max) n = "EXCELENTE";
            else if(this.score >= this.currCfg.max*0.9) n = "SOBRESALIENTE";
            document.getElementById('c-note').innerText = n;

            const idx = this.config.findIndex(l => l.id === this.currCfg.id);
            if(idx === this.unlocked) {
                this.unlocked++;
                localStorage.setItem('drive_lvl', this.unlocked);
            }
        } else {
            cert.style.display = 'none';
        }
    }
};

// ==========================================
// MOTOR DEL VIDEOJUEGO (V4.0 con Personalizaci√≥n)
// ==========================================
const Game = {
    cvs: null, ctx: null, loopId: null,
    
    // Estado
    state: {
        run: false, x: 0, speed: 0, distance: 0, roadOffset: 0,
        lights: [], nextLightDist: 1000, enemies: [], trees: [],
    },
    
    // Personalizaci√≥n
    player: { name: 'Conductor', color: '#3b82f6', type: 'sedan', win: '#1e3a8a', light: '#fef08a' },

    keys: { left: false, right: false, gas: false, brake: false },
    cfg: { laneW: 100, roadW: 240, maxSpd: 25, accel: 0.3, friction: 0.1, brake: 0.8 },

    init: function() {
        app.nav('v-game');
        // Mostrar men√∫ de setup
        document.getElementById('game-setup').style.display = 'flex';
        document.getElementById('game-layer').style.display = 'none';
    },

    launch: function() {
        // Guardar personalizaci√≥n
        this.player.name = document.getElementById('p-name').value || 'Conductor';
        this.player.color = document.getElementById('p-color').value;
        this.player.type = document.getElementById('p-model').value;
        this.player.win = document.getElementById('p-win').value;
        this.player.light = document.getElementById('p-light').value;

        document.getElementById('hud-name').innerText = this.player.name;
        document.getElementById('game-setup').style.display = 'none';
        document.getElementById('game-layer').style.display = 'flex';

        window.focus();
        Game.cvs = document.getElementById('sim-canvas');
        Game.ctx = Game.cvs.getContext('2d');
        
        const resize = () => {
            const p = Game.cvs.parentElement;
            Game.cvs.width = p.clientWidth;
            Game.cvs.height = p.clientHeight;
        };
        new ResizeObserver(resize).observe(Game.cvs.parentElement);
        resize();

        Game.bindInputs();
        Game.reset();
    },

    bindInputs: function() {
        window.onkeydown = (e) => Game.keyHandler(e, true);
        window.onkeyup = (e) => Game.keyHandler(e, false);
        const bindBtn = (id, key) => {
            const el = document.getElementById(id);
            const press = (e) => { e.preventDefault(); Game.keys[key] = true; el.classList.add('pressed'); };
            const release = (e) => { e.preventDefault(); Game.keys[key] = false; el.classList.remove('pressed'); };
            el.onmousedown = el.ontouchstart = press;
            el.onmouseup = el.ontouchend = el.onmouseleave = release;
        };
        bindBtn('btn-left', 'left'); bindBtn('btn-right', 'right'); bindBtn('btn-gas', 'gas'); bindBtn('btn-brake', 'brake');
    },

    keyHandler: function(e, val) {
        if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) e.preventDefault();
        const k = e.key.toLowerCase();
        if(k==='arrowleft'||k==='a') Game.keys.left=val; if(k==='arrowright'||k==='d') Game.keys.right=val;
        if(k==='arrowup'||k==='w') Game.keys.gas=val; if(k==='arrowdown'||k==='s') Game.keys.brake=val;
    },

    reset: function() {
        document.getElementById('game-msg').style.display = 'none';
        const w = Game.cvs.width;
        Game.state = { run: true, speed: 0, distance: 0, roadOffset: 0, x: w/2 + Game.cfg.laneW/2, lights: [], nextLightDist: 3000, enemies: [], trees: [] };
        Game.loop();
    },

    stop: function() { Game.state.run = false; cancelAnimationFrame(Game.loopId); },

    loop: function() { if(!Game.state.run) return; Game.update(); Game.draw(); Game.loopId = requestAnimationFrame(Game.loop); },

    update: function() {
        const s = Game.state; const c = Game.cfg;
        if(Game.keys.gas) s.speed += c.accel; else s.speed -= c.friction;
        if(Game.keys.brake) s.speed -= c.brake;
        if(s.speed > c.maxSpd) s.speed = c.maxSpd; if(s.speed < 0) s.speed = 0;
        if(s.speed > 0) { if(Game.keys.left) s.x -= 5; if(Game.keys.right) s.x += 5; }
        
        const centerX = Game.cvs.width / 2;
        if(s.x < centerX - c.roadW/2 + 20) s.x = centerX - c.roadW/2 + 20;
        if(s.x > centerX + c.roadW/2 - 20) s.x = centerX + c.roadW/2 - 20;

        s.distance += s.speed; s.roadOffset = (s.roadOffset + s.speed) % 80;
        s.nextLightDist -= s.speed;
        if(s.nextLightDist <= 0) { s.lights.push({ y: -500, state: 'green', timer: Date.now() }); s.nextLightDist = 8000 + Math.random()*4000; }
        
        const pY = Game.cvs.height - 120;
        s.lights.forEach(l => {
            l.y += s.speed;
            if((Date.now()-l.timer)/1000 > 35) { l.state = l.state==='green'?'red':'green'; l.timer = Date.now(); }
            if(l.state==='red' && l.y > pY && l.y < pY + s.speed + 20) Game.gameOver("¬°PASASTE LUZ ROJA!");
        });
        s.lights = s.lights.filter(l => l.y < Game.cvs.height + 200);

        if(Math.random() < 0.02) {
            const lane = Math.random()>0.5 ? -1 : 1;
            s.enemies.push({ x: centerX + (lane*c.laneW/2), y: -200, dir: lane, spd: lane===-1 ? 12 : 5 });
        }
        s.enemies.forEach(e => {
            e.y += (e.dir===-1 ? (s.speed+e.spd) : (s.speed-e.spd));
            if(Math.abs(s.x - e.x) < 30 && Math.abs(pY - e.y) < 60) Game.gameOver("¬°CHOQUE!");
        });
        s.enemies = s.enemies.filter(e => e.y < Game.cvs.height + 200);

        if(Math.random() < 0.15) s.trees.push({ y: -100, side: Math.random()>0.5 ? -1 : 1 });
        s.trees.forEach(t => t.y += s.speed); s.trees = s.trees.filter(t => t.y < Game.cvs.height + 100);

        document.getElementById('hud-spd').innerText = Math.floor(s.speed * 8);
        document.getElementById('hud-dist').innerText = Math.floor(s.distance / 100);
    },

    draw: function() {
        const ctx = Game.ctx; const w = Game.cvs.width; const h = Game.cvs.height;
        const s = Game.state; const c = Game.cfg; const cx = w/2;

        // Fondo c√©sped detallado
        ctx.fillStyle = '#064e3b'; ctx.fillRect(0,0,w,h);
        // Textura c√©sped (strips)
        ctx.fillStyle = '#065f46';
        for(let i=0; i<h; i+=40) {
            if((i + Math.floor(s.distance)) % 80 < 40) ctx.fillRect(0, i, w, 40);
        }

        const rx = cx - c.roadW/2;
        ctx.fillStyle = '#334155'; ctx.fillRect(rx, 0, c.roadW, h);
        ctx.fillStyle = '#fff'; ctx.fillRect(rx+5, 0, 5, h); ctx.fillRect(rx+c.roadW-10, 0, 5, h);
        
        ctx.strokeStyle = '#fbbf24'; ctx.lineWidth = 4; ctx.beginPath();
        ctx.setLineDash([30, 40]); ctx.lineDashOffset = -s.roadOffset;
        ctx.moveTo(cx, -50); ctx.lineTo(cx, h+50); ctx.stroke(); ctx.setLineDash([]);

        // √Årboles Mejorados
        s.trees.forEach(t => {
            const tx = t.side===-1 ? rx - 50 : rx + c.roadW + 50;
            // Sombra
            ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.beginPath(); ctx.arc(tx+5, t.y+5, 25, 0, Math.PI*2); ctx.fill();
            // Tronco
            ctx.fillStyle = '#451a03'; ctx.fillRect(tx-5, t.y-10, 10, 10);
            // Copa
            ctx.fillStyle = '#14532d'; ctx.beginPath(); ctx.arc(tx, t.y-15, 20, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = '#16a34a'; ctx.beginPath(); ctx.arc(tx-5, t.y-20, 15, 0, Math.PI*2); ctx.fill();
        });

        s.lights.forEach(l => {
            ctx.fillStyle = '#fff'; ctx.fillRect(rx, l.y, c.roadW, 10);
            if(l.y > -50 && l.y < h) {
                ctx.fillStyle = '#111'; ctx.fillRect(rx+c.roadW+5, l.y-200, 10, 200);
                ctx.fillRect(rx+c.roadW-60, l.y-200, 80, 40);
                const col = l.state==='green'?'#22c55e':'#ef4444';
                ctx.fillStyle = col; ctx.shadowColor = col; ctx.shadowBlur = 20;
                ctx.beginPath(); ctx.arc(rx+c.roadW-30, l.y-180, 12, 0, Math.PI*2); ctx.fill(); ctx.shadowBlur = 0;
            }
        });

        s.enemies.forEach(e => {
            ctx.save(); ctx.translate(e.x, e.y);
            ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.fillRect(-14, -22, 28, 54);
            ctx.fillStyle = e.dir===-1 ? '#ef4444' : '#f59e0b';
            ctx.fillRect(-15,-25,30,50);
            if(e.dir===-1) { ctx.fillStyle='#fff'; ctx.fillRect(-12,20,8,5); ctx.fillRect(4,20,8,5); }
            else { ctx.fillStyle='#7f1d1d'; ctx.fillRect(-12,20,8,5); ctx.fillRect(4,20,8,5); }
            ctx.restore();
        });

        // JUGADOR PERSONALIZADO
        const p = Game.player;
        const py = h - 120;
        ctx.save(); ctx.translate(s.x, py);
        // Sombra
        ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.fillRect(-16, -22, 32, 58);
        
        // Cuerpo seg√∫n tipo
        ctx.fillStyle = p.color;
        if(p.type === 'sport') {
            ctx.fillRect(-18, -25, 36, 50); // Ancho
        } else if(p.type === 'suv') {
            ctx.fillRect(-16, -30, 32, 60); // Largo
        } else {
            ctx.fillRect(-15, -25, 30, 50); // Sed√°n normal
        }

        // Techo/Parabrisas
        ctx.fillStyle = p.win; 
        ctx.fillRect(-12,-10,24,25);

        // Luces Traseras
        ctx.fillStyle = Game.keys.brake ? '#ff0000' : '#7f1d1d';
        ctx.shadowColor = Game.keys.brake ? '#ff0000' : 'transparent'; ctx.shadowBlur = Game.keys.brake?20:0;
        ctx.fillRect(-13, 22, 8, 5); ctx.fillRect(5, 22, 8, 5); ctx.shadowBlur=0;

        // Luces Delanteras (Proyectadas)
        ctx.fillStyle = p.light; ctx.globalAlpha = 0.3;
        ctx.beginPath(); ctx.moveTo(-10, -25); ctx.lineTo(-40, -150); ctx.lineTo(0, -150); ctx.fill();
        ctx.beginPath(); ctx.moveTo(10, -25); ctx.lineTo(40, -150); ctx.lineTo(0, -150); ctx.fill();
        
        ctx.globalAlpha = 1; ctx.restore();
    },

    gameOver: function(msg) {
        Game.state.run = false;
        document.getElementById('fail-reason').innerText = msg;
        document.getElementById('game-msg').style.display = 'block';
    }
};

app.init();
</script>
</body>
</html>
