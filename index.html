<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certi-Vial</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Certi-Vial">
    <link rel="apple-touch-icon" href="icono-app.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        /* --- TEMA 3D DEEP GLASS --- */
        :root {
            --bg-base: #020005;
            --bg-gradient: 
                radial-gradient(at 0% 0%, rgba(120, 50, 255, 0.4) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(50, 200, 255, 0.3) 0px, transparent 50%);
            
            --primary: #d8b4fe; 
            --secondary: #22d3ee;
            --accent: #f472b6;
            --text: #ffffff;
            --text-dim: #94a3b8;
            --error: #fb7185;
            --success: #4ade80;
        }

        body {
            margin: 0; font-family: 'Outfit', sans-serif;
            background-color: var(--bg-base);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            background-size: cover;
            color: var(--text);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            /* Prevenir rebote el√°stico en iOS */
            overscroll-behavior-y: none;
        }

        #app {
            width: 100%; max-width: 600px;
            min-height: 90vh;
            background: rgba(20, 20, 30, 0.5);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px;
            box-shadow: 0 40px 80px -20px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
            margin: 20px;
            overflow: hidden;
            position: relative;
        }

        /* Header */
        header {
            padding: 30px 35px; 
            display: flex; justify-content: space-between; align-items: flex-start;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            /* Ajuste para respetar el notch/isla din√°mica del iPhone si es necesario */
            padding-top: env(safe-area-inset-top, 30px); 
        }
        h1 { 
            margin: 10px 0 0 0; font-size: 1.8rem; font-weight: 800; letter-spacing: -1px;
            background: linear-gradient(to right, #fff, #cbd5e1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        /* Contenedor derecho (Reset + Timer) */
        .header-right {
            display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
        }

        button.reset {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.05); 
            color: var(--text-dim);
            padding: 8px 16px; border-radius: 30px; cursor: pointer; transition: 0.3s;
            font-weight: 600; font-size: 0.75rem; font-family: 'Outfit', sans-serif;
            /* Evitar zoom al tocar en iOS */
            touch-action: manipulation;
        }
        button.reset:hover { background: rgba(251, 113, 133, 0.15); color: #fff; border-color: var(--error); }

        /* Estilo del Timer */
        #timer-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--secondary);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.4);
            opacity: 0;
            transition: opacity 0.5s;
        }
        #timer-display.active { opacity: 1; }
        #timer-display.danger { color: var(--error); animation: pulse-text 1s infinite; }

        @keyframes pulse-text { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .view { padding: 40px; display: none; flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .view.active { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        /* --- INTERACCI√ìN Y ANIMACIONES --- */
        .spotlight {
            position: relative;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.3s, border-color 0.3s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); 
            /* Desactivar resaltado gris al tocar en m√≥viles */
            -webkit-tap-highlight-color: transparent;
        }
        .spotlight::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(600px circle at var(--mouse-x) var(--mouse-y), rgba(255, 255, 255, 0.1), transparent 40%);
            opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 1;
        }
        .spotlight:hover { border-color: rgba(255,255,255,0.2); }
        .spotlight:hover::before { opacity: 1; }
        .spotlight:active { transform: translateY(4px); box-shadow: 0 0 0 rgba(0,0,0,0); }

        /* ANIMACI√ìN DE SELECCI√ìN DE CATEGOR√çA */
        .card-btn { padding: 30px; margin-bottom: 20px; display: flex; align-items: center; transition: 0.3s; }
        
        .card-selected {
            background: rgba(74, 222, 128, 0.15) !important;
            border-color: var(--success) !important;
            box-shadow: 0 0 30px rgba(74, 222, 128, 0.3) !important;
            transform: scale(0.96) !important;
        }

        .card-btn h3 { margin: 0 0 5px 0; color: #fff; font-size: 1.3rem; font-weight: 700; }
        .card-btn small { color: var(--text-dim); font-weight: 500; }
        .card-icon { font-size: 3rem; margin-right: 25px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }

        .action-btn {
            width: 100%; padding: 25px; 
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)); 
            color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
            font-size: 1rem; margin-top: 30px; text-align: center;
            font-family: 'Outfit', sans-serif;
            border-bottom: 4px solid rgba(0,0,0,0.3); 
            touch-action: manipulation;
        }
        .action-btn.primary {
            background: linear-gradient(135deg, rgba(192, 132, 252, 0.2), rgba(34, 211, 238, 0.1));
            border: 1px solid rgba(192, 132, 252, 0.3);
            border-bottom: 4px solid rgba(192, 132, 252, 0.3);
        }

        /* Niveles */
        .lvl-row {
            padding: 22px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
            border-radius: 20px; background: rgba(255,255,255,0.02); transition: 0.2s;
        }
        .lvl-row.unlocked:hover { background: rgba(255,255,255,0.05); transform: translateX(5px); }
        .lvl-row.locked { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
        .badge { 
            padding: 6px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 800; 
            background: #111; color: var(--text-dim); border: 1px solid #333;
        }
        .unlocked .badge { background: var(--primary); color: #000; border: none; box-shadow: 0 0 15px var(--primary); }

        /* Estudio */
        .study-scroll { display: flex; flex-direction: column; gap: 15px; max-height: 55vh; overflow-y: auto; padding-right: 10px; }
        .study-card {
            background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05);
            border-left: 3px solid var(--secondary); border-radius: 16px; padding: 25px;
            animation: slideIn 0.4s ease-out forwards; opacity: 0; transform: translateX(-20px);
        }
        .study-q { color: var(--secondary); font-size: 0.8rem; font-weight: 800; margin-bottom: 10px; text-transform: uppercase; }
        .study-a { font-size: 1.1rem; color: #ddd; line-height: 1.5; font-weight: 300; }
        @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
        .study-card:nth-child(1) { animation-delay: 0.05s; }
        .study-card:nth-child(2) { animation-delay: 0.1s; }
        .study-card:nth-child(3) { animation-delay: 0.15s; }

        /* Examen */
        .progress { height: 6px; background: rgba(255,255,255,0.05); margin-bottom: 30px; border-radius: 10px; overflow: hidden; }
        .bar { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--primary)); width: 0%; transition: 0.8s ease; }
        .q-box { min-height: 110px; margin-bottom: 30px; font-size: 1.4rem; line-height: 1.4; font-weight: 600; color:#fff; }
        .opt-btn {
            display: block; width: 100%; padding: 25px; margin-bottom: 15px;
            text-align: left; font-size: 1.1rem; color: #ccc; font-family: 'Outfit', sans-serif;
            touch-action: manipulation;
        }
        .opt-btn:hover { color: white; background: rgba(255,255,255,0.08); }
        textarea {
            width: 100%; height: 150px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);
            color: white; padding: 20px; border-radius: 20px; font-size: 1.1rem; outline: none; font-family: inherit;
        }

        /* Micr√≥fono */
        .mic-btn {
            width: 90px; height: 90px; background: rgba(255,255,255,0.05); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; margin: 0 auto 20px; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1);
            -webkit-tap-highlight-color: transparent;
        }
        .mic-btn:hover { border-color: var(--primary); box-shadow: 0 0 30px var(--primary); transform: scale(1.1); }
        .mic-btn.recording { background: rgba(251, 113, 133, 0.2); border-color: var(--error); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* Resultados */
        .score-display { font-size: 6rem; text-align: center; font-weight: 900; margin: 20px 0; letter-spacing: -3px; }
        .cert {
            border: 1px solid rgba(255,255,255,0.1); padding: 40px; margin-top: 30px;
            background: #fff; color: #000; position: relative; text-align: center;
            border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .stamp {
            position: absolute; top: 20px; right: 20px; border: 4px solid #d32f2f; color: #d32f2f;
            padding: 5px 15px; border-radius: 10px; font-weight: 900; transform: rotate(-15deg);
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

        #crash-screen { display: none; background: #2a0a18; color: #ff99aa; padding: 30px; position: fixed; top:0; left:0; width:100%; height:100%; z-index:9999; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <h1>Certi-Vial</h1>
        <div class="header-right">
            <button class="reset" onclick="app.reset()">‚ü≥ Reiniciar</button>
            <div id="timer-display">15:00</div>
        </div>
    </header>

    <div id="v-home" class="view active">
        <p style="text-align:center; color:var(--text-dim); margin-bottom:40px; font-size:1.1rem;">Seleccione su categor√≠a:</p>
        <div class="card-btn spotlight" onclick="app.setCat('A-I', this)">
            <div class="card-icon">üöó</div>
            <div><h3>Veh√≠culo Particular</h3><small>Categor√≠a A-I</small></div>
        </div>
        <div class="card-btn spotlight" onclick="app.setCat('B-IIc', this)">
            <div class="card-icon">üõ∫</div>
            <div><h3>Mototaxi</h3><small>Categor√≠a B-IIc</small></div>
        </div>
    </div>

    <div id="v-levels" class="view">
        <div style="display:flex; justify-content:space-between; margin-bottom:30px; align-items:center;">
            <h3 style="margin:0; font-size:1.5rem;">Niveles</h3>
            <span id="cat-lbl" style="color:var(--primary); font-weight:bold; background:rgba(255,255,255,0.05); padding:8px 16px; border-radius:12px;">CAT</span>
        </div>
        <div id="lvl-list"></div>
        <button class="action-btn spotlight" onclick="app.nav('v-home')">Volver al Inicio</button>
    </div>

    <div id="v-study" class="view">
        <h3 style="text-align:center; margin:0; color:var(--secondary); letter-spacing:2px; font-size:0.9rem;">PREPARACI√ìN</h3>
        <p style="text-align:center; color:var(--text-dim); font-size:1.2rem; margin-bottom:30px; font-weight:300;">Micro-Sesi√≥n de Estudio</p>
        
        <div id="study-container" class="study-scroll"></div>

        <button class="action-btn spotlight primary" onclick="app.startExam()">¬°Estoy Listo!</button>
    </div>

    <div id="v-exam" class="view">
        <div class="progress"><div id="bar" class="bar"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.9rem; color:var(--text-dim); margin-bottom:15px; text-transform:uppercase; font-weight:700; letter-spacing:1px;">
            <span id="ex-name">Nivel</span>
            <span id="ex-count">0/0</span>
        </div>
        <div id="q-text" class="q-box">Pregunta...</div>
        <div id="q-area"></div>
    </div>

    <div id="v-result" class="view">
        <h2 style="text-align:center; margin-top:0; color:var(--text);">Resultados</h2>
        <div id="res-val" class="score-display">0</div>
        <p id="res-msg" style="text-align:center; color:var(--text-dim); margin-bottom:30px; font-size:1.2rem;"></p>

        <div id="cert" class="cert" style="display:none">
            <div class="stamp">APROBADO</div>
            <h2 style="margin:0 0 20px 0; letter-spacing:3px;">CERTIFICADO</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; text-align:left; border-top:2px dashed #999; padding-top:20px;">
                <p style="margin:5px 0"><strong>Categor√≠a:</strong> <span id="c-cat">A</span></p>
                <p style="margin:5px 0"><strong>Nivel:</strong> <span id="c-lvl">1</span></p>
                <p style="margin:5px 0; grid-column:span 2; font-size:1.2rem;"><strong>Nota:</strong> <span id="c-note" style="font-weight:900">OK</span></p>
            </div>
        </div>
        <button class="action-btn spotlight primary" onclick="app.nav('v-levels'); app.renderLvl()">Continuar</button>
    </div>
</div>

<script>
window.onerror = function(msg, url, line) {
    document.getElementById('crash-screen').style.display = 'block';
    document.getElementById('error-detail').innerText = `${msg}\nL√≠nea: ${line}`;
    document.getElementById('app').style.display = 'none';
};

const DB = {
    'A1': [
        { q: "1. Seg√∫n el Manual de Dispositivos, ¬øqu√© forma tiene exclusivamente la se√±al reglamentaria R-1 'PARE'?", opts: ["Circular", "Octogonal (8 lados)", "Triangular", "Rectangular"], a: 1, learn: "üõë **Forma √önica:** El PARE es la √∫nica se√±al con 8 lados (oct√≥gono) para ser reconocida incluso de espaldas." },
        { q: "2. Seg√∫n el RNV, ¬øa qu√© categor√≠a pertenecen los veh√≠culos de pasajeros de 4 ruedas o m√°s?", opts: ["Categor√≠a L", "Categor√≠a N", "Categor√≠a O", "Categor√≠a M"], a: 3, learn: "üöó **Categor√≠a M:** 'M' de 'Movimiento de personas'. Autos y buses son M. Carga es N, Motos son L." },
        { q: "3. Seg√∫n el Reglamento de Licencias, ¬øcu√°l es la vigencia de la Licencia A-I si no tiene infracciones?", opts: ["2 a√±os", "5 a√±os", "8 a√±os", "10 a√±os"], a: 3, learn: "üìÖ **Vigencia:** Si eres un conductor ejemplar sin multas, tu licencia A-I te dura una d√©cada completa." },
        { q: "4. En el sem√°foro vehicular, ¬øqu√© indica la luz roja fija?", opts: ["Precauci√≥n", "Los veh√≠culos deben detenerse", "Girar con cuidado", "Avanzar"], a: 1, learn: "üî¥ **Rojo Fijo:** Significa peligro y detenci√≥n absoluta. No cruces la l√≠nea de parada." },
        { q: "5. Seg√∫n el RENAT, ¬øqu√© documento acredita la habilitaci√≥n para prestar servicio de transporte?", opts: ["Licencia de Conducir", "DNI", "Tarjeta √önica de Circulaci√≥n (TUC)", "Factura"], a: 2, learn: "üìÑ **Habilitaci√≥n:** La TUC (Tarjeta √önica de Circulaci√≥n) es el DNI del veh√≠culo para trabajar legalmente." },
        { q: "6. Seg√∫n el Manual, las se√±ales de color AMARILLO con s√≠mbolos negros sirven para:", opts: ["Prohibir (Reglamentarias)", "Informar (Informativas)", "Advertir peligros (Preventivas)", "Zonas tur√≠sticas"], a: 2, learn: "‚ö†Ô∏è **Alerta:** El color amarillo siempre te advierte de un peligro potencial m√°s adelante (Curvas, cruces, etc.)." },
        { q: "7. Seg√∫n el RNV, ¬øa qu√© categor√≠a pertenecen los veh√≠culos de 2 o 3 ruedas (motos/mototaxis)?", opts: ["Categor√≠a M", "Categor√≠a L", "Categor√≠a N", "Categor√≠a O"], a: 1, learn: "üèçÔ∏è **Ligeros:** Las motos y mototaxis pertenecen a la categor√≠a 'L' (Veh√≠culos menores)." },
        { q: "8. Edad m√≠nima para obtener licencia A-I por otorgamiento directo:", opts: ["16 a√±os", "21 a√±os", "18 a√±os", "20 a√±os"], a: 2, learn: "üéÇ **Mayor√≠a de Edad:** Para la licencia particular (A-I) debes tener 18 a√±os cumplidos." },
        { q: "9. Seg√∫n el Manual, ¬øqu√© forma tiene la se√±al R-2 'CEDA EL PASO'?", opts: ["C√≠rculo rojo", "Tri√°ngulo equil√°tero invertido", "Oct√°gono", "Rombo"], a: 1, learn: "üîª **Prioridad:** El tri√°ngulo invertido te dice 'Cede el Paso'. Baja la velocidad y para si es necesario." },
        { q: "10. Seg√∫n el RENAT, jornada m√°xima de conducci√≥n continua en servicio DIURNO:", opts: ["4 horas", "8 horas", "5 horas", "6 horas"], a: 2, learn: "‚òÄÔ∏è **Jornada Diurna:** De d√≠a, el m√°ximo continuo al volante son 5 horas. De noche baja a 4." },
        { q: "11. Elemento de seguridad obligatorio para TODOS los ocupantes de un M1 (auto):", opts: ["Casco", "Cintur√≥n de seguridad", "Extintor", "Botiqu√≠n"], a: 1, learn: "üîí **Vida:** El cintur√≥n de seguridad es obligatorio para TODOS los asientos, no solo el chofer." },
        { q: "12. ¬øQu√© indica una l√≠nea central CONTINUA de color amarillo?", opts: ["Se puede adelantar", "Carril buses", "Prohibido cruzar/adelantar", "Estacionar"], a: 2, learn: "üöß **Muro:** La l√≠nea amarilla continua es una pared virtual. Prohibido adelantar o invadir el carril contrario." },
        { q: "13. Licencia necesaria para conducir veh√≠culos menores (motos/mototaxis):", opts: ["Clase A", "Clase B", "Clase C", "Clase M"], a: 1, learn: "üõ∫ **Clasificaci√≥n:** Clase A es para carros/camiones. Clase B es exclusiva para motos y mototaxis." },
        { q: "14. Color de fondo de se√±ales en zonas de trabajo (construcci√≥n):", opts: ["Amarillo", "Naranja", "Verde", "Rojo"], a: 1, learn: "üü† **Obras:** El color naranja indica construcci√≥n o mantenimiento en la v√≠a. Reduce velocidad." },
        { q: "15. Seg√∫n el RNV, la Categor√≠a N es para veh√≠culos de transporte de:", opts: ["Pasajeros", "Mercanc√≠as (Carga)", "Motocicletas", "Remolques"], a: 1, learn: "üöö **Carga:** La categor√≠a 'N' es para transporte de mercanc√≠as (camiones, furgones)." },
        { q: "16. Seguro obligatorio para cubrir da√±os personales en accidentes:", opts: ["Seguro robos", "Seguro vida", "SOAT", "Seguro privado"], a: 2, learn: "üè• **Cobertura:** El SOAT cubre muerte y lesiones de todas las v√≠ctimas, ocupantes o peatones." },
        { q: "17. Color de fondo de se√±ales informativas de servicios generales:", opts: ["Azul", "Verde", "Blanco", "Marr√≥n"], a: 0, learn: "‚õΩ **Servicios:** El fondo AZUL te informa sobre grifos, hoteles, restaurantes o auxilios." },
        { q: "18. ¬øQu√© significa la sigla VIN?", opts: ["Veh√≠culo Industria Nacional", "Valor Interno", "N√∫mero de Identificaci√≥n Vehicular", "Verificaci√≥n"], a: 2, learn: "üî¢ **Huella Digital:** El VIN es el n√∫mero de serie √∫nico que identifica a tu veh√≠culo a nivel mundial." },
        { q: "19. Validez del certificado de salud para licencias:", opts: ["Solo distrito", "Solo Lima", "A nivel nacional", "Solo regi√≥n"], a: 2, learn: "üáµüá™ **Alcance:** Tu examen m√©dico vale en todo el Per√∫, no importa d√≥nde lo sacaste." },
        { q: "20. ¬øQu√© significan las flechas pintadas en el pavimento?", opts: ["Adorno", "Direcci√≥n obligatoria/permitida", "Estacionar", "Velocidad"], a: 1, learn: "‚¨áÔ∏è **Guiado:** Las flechas en el piso te obligan a seguir esa direcci√≥n (seguir recto, voltear, etc.)." }
    ],
    'A2': [
        { q: "1. Intersecci√≥n sin sem√°foro con se√±al CEDA EL PASO (R-2):", opts: ["Tocar claxon", "Detenerse obligatoriamente", "Disminuir/Detenerse si es necesario", "Acelerar"], a: 2, learn: "üîΩ **Ceda el Paso:** A diferencia del PARE, aqu√≠ no est√°s obligado a detenerte si no viene nadie." },
        { q: "2. L√≠mite m√°ximo velocidad en CALLES de zona urbana:", opts: ["30 km/h", "40 km/h", "50 km/h", "60 km/h"], a: 0, learn: "üè† **Calles:** La nueva normativa redujo la velocidad m√°xima en calles a 30 km/h (antes 40)." },
        { q: "3. L√≠nea central amarilla DISCONTINUA (segmentada):", opts: ["Un solo sentido", "Prohibido adelantar", "Doble sentido/Permite adelantar", "Estacionamiento"], a: 2, learn: "üü° **Doble Sentido:** La l√≠nea amarilla divide el tr√°fico opuesto. Si es discontinua, puedes adelantar." },
        { q: "4. Conducir sin lentes si la licencia lo exige (Restricci√≥n):", opts: ["Nada si es d√≠a", "Falta leve", "Infracci√≥n Grave (G.19)", "Solo ponerse"], a: 2, learn: "üëì **Obligaci√≥n:** No usar lentes correctores es una infracci√≥n Grave (G.19) y conlleva multa." },
        { q: "5. Prioridad de paso en una rotonda (√≥valo):", opts: ["El que ingresa", "El m√°s r√°pido", "El que circula DENTRO", "Transporte p√∫blico"], a: 2, learn: "üîÑ **Regla de Oro:** En el √≥valo, el que ya est√° adentro tiene la preferencia sobre el que quiere entrar." },
        { q: "6. Profundidad m√≠nima surcos neum√°ticos autom√≥vil (M1):", opts: ["1.0 mm", "1.6 mm", "2.0 mm", "3.0 mm"], a: 1, learn: "üìè **Seguridad:** Para autos particulares, la ley exige una cocada m√≠nima de 1.6 mm." },
        { q: "7. Significado luz INTERMITENTE ROJA en sem√°foro:", opts: ["Malogrado", "Equivale a PARE", "Equivale a CEDA EL PASO", "Esperar verde"], a: 1, learn: "üõë **Alto Total:** El rojo intermitente es igual a una se√±al de PARE. Detente, mira y avanza." },
        { q: "8. Distancia m√≠nima para estacionar de una esquina/intersecci√≥n:", opts: ["3 metros", "5 metros", "6 metros", "10 metros"], a: 3, learn: "üìê **Visibilidad:** Debes dejar 10 metros libres desde la esquina para no tapar la visi√≥n del cruce." },
        { q: "9. Documento obligatorio veh√≠culo > 4 a√±os antig√ºedad:", opts: ["Factura", "CITV (Revisi√≥n T√©cnica)", "Manual usuario", "Seguro robos"], a: 1, learn: "üîß **Estado:** A partir del 4to a√±o, todo auto particular debe tener su Certificado de Inspecci√≥n T√©cnica." },
        { q: "10. Encuentro con veh√≠culo de emergencia (luces/sirena):", opts: ["Acelerar", "Mantener", "Derecha y detenerse", "Claxon"], a: 2, learn: "üöë **Paso:** Siempre mu√©vete a la derecha y detente para dejar pasar a ambulancias o bomberos." },
        { q: "11. Se√±al vertical P-33A (tri√°ngulo amarillo con 'joroba'):", opts: ["Puente", "Reductor de velocidad (Rompemuelles)", "Resbaladizo", "Derrumbes"], a: 1, learn: "üöß **Aviso:** Esa 'joroba' te advierte que viene un rompemuelles. ¬°Baja la velocidad!" },
        { q: "12. Carril para adelantar en v√≠a de 3 carriles (mismo sentido):", opts: ["Cualquiera", "Derecha", "Centro", "Extremo Izquierdo"], a: 3, learn: "‚¨ÖÔ∏è **Orden:** El carril izquierdo es el m√°s r√°pido y exclusivo para adelantar." },
        { q: "13. Vigencia licencia A-I tras inhabilitaci√≥n temporal:", opts: ["8 a√±os", "5 a√±os", "3 a√±os", "2 a√±os"], a: 1, learn: "üìâ **Penalidad:** Si te sancionaron con suspensi√≥n, tu pr√≥xima licencia solo durar√° 5 a√±os." },
        { q: "14. Se√±al c√≠rculo rojo con 'E' tachada:", opts: ["Permitido", "Exclusivo", "Prohibido Estacionar", "Prohibido Detenerse"], a: 2, learn: "üö´ **Estacionamiento:** La E tachada significa 'No Estacionar', pero s√≠ puedes detenerte brevemente a dejar pasajeros." },
        { q: "15. Tasa de alcohol permitida transporte p√∫blico/taxi:", opts: ["0.50 g/l", "0.25 g/l", "0.10 g/l", "0.00 g/l"], a: 3, learn: "üç∑ **Tolerancia Cero:** Si llevas pasajeros (servicio p√∫blico), no puedes tener ni una gota de alcohol." },
        { q: "16. Preferencia en intersecci√≥n NO semaforizada:", opts: ["Llega primero", "Viene por DERECHA", "Viene por izquierda", "El grande"], a: 1, learn: "üëâ **Regla General:** Si no hay se√±ales, cede el paso al veh√≠culo que aparece por tu mano derecha." },
        { q: "17. Uso de bocina (claxon) para apurar:", opts: ["S√≠, agilizar", "S√≠, hora punta", "No, prohibido (solo peligro)", "S√≠, corto"], a: 2, learn: "üì¢ **Ruido:** El claxon es solo para evitar accidentes, no para descargar tu estr√©s o apurar." },
        { q: "18. L√≠nea de borde de calzada AMARILLA continua:", opts: ["Estacionar berma", "Doble sentido", "Prohibido estacionar/detenerse", "Escolar"], a: 2, learn: "‚õî **Restricci√≥n Total:** Borde amarillo significa que est√° prohibido estacionar y tambi√©n detenerse." },
        { q: "19. Sanci√≥n por conducir sin SOAT vigente:", opts: ["Solo multa", "Multa + Retenci√≥n veh√≠culo", "Amonestaci√≥n", "Retenci√≥n licencia"], a: 1, learn: "üõë **Grave:** Sin SOAT, tu auto se va al dep√≥sito y t√∫ te llevas una multa fuerte." },
        { q: "20. Se√±al P-48 (Rombo amarillo con silueta caminando):", opts: ["Escolar", "Prohibido peatones", "Presencia de Peatones", "Paradero"], a: 2, learn: "üö∂ **Atenci√≥n:** Advierte que es probable que crucen peatones en la zona pr√≥xima." }
    ],
    'B1': [
        { q: "1. Conducta ante luz intermitente √ÅMBAR (amarilla):", opts: ["Detenerse como luz roja", "Disminuir/Precauci√≥n", "Acelerar para despejar", "Esperar verde fijo"], a: 1, learn: "‚ö†Ô∏è **Precauci√≥n:** El √°mbar intermitente no te obliga a parar, pero s√≠ a reducir velocidad y cruzar con mucho cuidado." },
        { q: "2. Vigencia A-I tras inhabilitaci√≥n temporal:", opts: ["8 a√±os", "5 a√±os", "3 a√±os", "2 a√±os"], a: 1, learn: "üìâ **Castigo:** Si te inhabilitaron temporalmente, tu pr√≥xima licencia A-I durar√° solo la mitad (5 a√±os) en lugar de 10." },
        { q: "3. Elemento de seguridad obligatorio M1 (adem√°s de rueda):", opts: ["Gal√≥n de agua", "Gata/Llave/Tri√°ngulo", "Soga remolque", "Cables corriente"], a: 1, learn: "üîß **Kit B√°sico:** Es obligatorio llevar gata, llave de ruedas y tri√°ngulo para emergencias en la v√≠a." },
        { q: "4. L√≠nea de borde de calzada AMARILLA continua:", opts: ["Estacionar en berma", "Doble sentido", "Prohibido estacionar", "Zona neblina"], a: 2, learn: "üö´ **Prohibici√≥n:** Si el borde es amarillo, ¬°ni se te ocurra estacionar! Es una zona restringida." },
        { q: "5. Conducir con lunas polarizadas sin permiso:", opts: ["No es infracci√≥n d√≠a", "Infracci√≥n Reglamento Tr√°nsito", "Infracci√≥n administrativa", "Advertencia verbal"], a: 1, learn: "üëÆ **Infracci√≥n:** El polarizado sin permiso es una falta grave al Reglamento Nacional de Tr√°nsito." },
        { q: "6. Significado se√±al R-4 (C√≠rculo rojo con barra horizontal):", opts: ["Prohibido estacionar", "NO ENTRE (Ingreso prohibido)", "Aduana", "Calle sin salida"], a: 1, learn: "‚õî **Acceso:** La se√±al R-4 te grita '¬°Por aqu√≠ NO!'. Proh√≠be entrar en esa direcci√≥n." },
        { q: "7. Vigencia Certificado de Salud para revalidar A-I:", opts: ["15 d√≠as", "30 d√≠as", "6 meses", "1 a√±o"], a: 2, learn: "ü©∫ **Validez M√©dica:** Tu examen m√©dico sirve por 6 meses para completar el tr√°mite." },
        { q: "8. Categor√≠a de camioneta Pick-up < 3.5t:", opts: ["M1", "M2", "N1", "N2"], a: 2, learn: "üöõ **Carga Ligera:** Las pick-up son veh√≠culos de carga (N) ligeros (1), por eso son N1." },
        { q: "9. Distancia aproximada se√±al P-33A (Resalto):", opts: ["Ah√≠ mismo", "60m antes", "500m", "10m"], a: 1, learn: "üöß **Anticipaci√≥n:** La se√±al te avisa con tiempo (m√≠nimo 60m) para que frenes antes del rompemuelles." },
        { q: "10. ¬øNi√±o < 5 a√±os en asiento copiloto?:", opts: ["S√≠ con cintur√≥n", "S√≠ cargado", "No, atr√°s obligatorio", "S√≠ con airbag"], a: 2, learn: "üë∂ **Seguridad Infantil:** Los ni√±os peque√±os son fr√°giles. Por ley, siempre deben ir atr√°s." },
        { q: "11. Se√±al 'X' blanca 'FERROCARRIL' (P-44):", opts: ["Cruce peatones", "Obras", "Cruce ferroviario a nivel", "Intersecci√≥n avenidas"], a: 2, learn: "üöÇ **Tren:** La Cruz de San Andr√©s avisa que vas a cruzar una v√≠a de tren al mismo nivel." },
        { q: "12. Cambio de motor a otro combustible (gasolina -> GLP):", opts: ["Nada", "Cambio TIV + Certificado", "Solo revisi√≥n t√©cnica", "Avisar polic√≠a"], a: 1, learn: "üìù **Registros:** Si cambias el 'coraz√≥n' o la 'sangre' del auto, debes actualizar la Tarjeta de Propiedad." },
        { q: "13. Se√±al R-18 (Camiones derecha) en v√≠a de 3 carriles:", opts: ["Cualquiera", "Izquierdo", "Exclusivamente derecho", "Central"], a: 2, learn: "üöö **Orden:** Los pesados son lentos, as√≠ que deben mantenerse obligatoriamente a la derecha." },
        { q: "14. Edad m√°xima licencia profesional (A-II en adelante):", opts: ["70 a√±os", "75 a√±os", "80 a√±os", "No hay l√≠mite"], a: 2, learn: "üë¥ **L√≠mite:** A los 80 a√±os se termina la carrera de conductor profesional por seguridad." },
        { q: "15. 'Malla Ortogonal' (cuadr√≠cula amarilla) en intersecci√≥n:", opts: ["Zona peatonal", "No bloquear cruce", "Paradero taxis", "Estacionamiento emergencia"], a: 1, learn: "‚ùå **No Bloquear:** ¬°El suelo es lava! Nunca te detengas dentro de la cuadr√≠cula amarilla." },
        { q: "16. ¬øConducir con A-I vencida en tr√°mite?:", opts: ["S√≠ con constancia", "S√≠ 30 d√≠as gracia", "No, prohibido", "S√≠ en distrito"], a: 2, learn: "üö´ **Vencida es Vencida:** No hay permisos especiales. Si caduc√≥, no manejas hasta tener la nueva." },
        { q: "17. Se√±al I-19 (Cuadrado azul surtidor):", opts: ["Prohibido estacionar", "Grifo pr√≥ximo", "Peligro incendio", "Mec√°nico"], a: 1, learn: "‚õΩ **Servicios:** El surtidor azul te avisa que hay una estaci√≥n de gasolina cerca." },
        { q: "18. Profundidad m√≠nima neum√°ticos M1 (auto):", opts: ["1.0 mm", "1.6 mm", "2.0 mm", "3.0 mm"], a: 1, learn: "üìè **Llantas:** Para autos (M1), la ley exige al menos 1.6mm de cocada para tener agarre." },
        { q: "19. L√≠mite m√°x zona escolar (Reglamento Tr√°nsito):", opts: ["20 km/h", "30 km/h", "35 km/h", "40 km/h"], a: 1, learn: "üè´ **Despacio:** En zona escolar, la regla general es 30 km/h para proteger a los estudiantes." },
        { q: "20. Sanci√≥n por negarse a alcoholemia (A-I):", opts: ["Multa simple", "Presunci√≥n + Susp/Cancela + Multa", "Amonestaci√≥n", "Solo retenci√≥n"], a: 1, learn: "üç∑ **Muy Grave:** Negarte es confesar. Te suspenden o cancelan la licencia y te multan fuerte." },
        { q: "21. Explique conducta ante se√±al CEDA EL PASO:", type: "TEXT", key: ["disminuir", "detenerse", "ceder", "preferencia"], learn: "‚ñº **Ceda el Paso:** No siempre paras, pero debes bajar la velocidad y dejar pasar a quien tenga preferencia." },
        { q: "22. ¬øVigencia y alcance del certificado de salud?", type: "TEXT", key: ["6 meses", "seis meses", "nacional"], learn: "üåç **Validez:** El examen m√©dico vale por 6 meses y sirve en todo el Per√∫." }
    ],
    'B2': [
        { q: "1. Significado 'Rejilla/Malla Ortogonal' (Caja Amarilla) en cruce:", opts: ["Estacionamiento", "No bloquear cruce", "Diagonal peatonal", "Parada bus"], a: 1, learn: "‚ùå **Zona Prohibida:** Nunca te detengas encima. Si no tienes espacio para cruzar, espera detr√°s de la l√≠nea." },
        { q: "2. ¬øCon A-I puedo conducir moto (L3)?", opts: ["S√≠, cubre todo", "S√≠, si es autom√°tica", "No, requiere Clase B", "S√≠ particular"], a: 2, learn: "üèçÔ∏è **Especializaci√≥n:** La A-I es para autos (4 ruedas). Para motos (2 o 3 ruedas) necesitas licencia Clase B." },
        { q: "3. Primera Inspecci√≥n T√©cnica (CITV) para auto nuevo (M1):", opts: ["Inmediata", "2do a√±o", "4to a√±o", "3er a√±o"], a: 2, learn: "üÜï **Exoneraci√≥n:** Los autos particulares nuevos est√°n libres de revisi√≥n t√©cnica durante sus primeros 4 a√±os." },
        { q: "4. Intersecci√≥n sin sem√°foro: ¬øQui√©n tiene preferencia?", opts: ["Usted (izquierda)", "El m√°s r√°pido", "El de la derecha", "El grande"], a: 2, learn: "üëâ **Derecha Manda:** En cruces no regulados, la prioridad SIEMPRE la tiene quien aparece por tu derecha." },
        { q: "5. Funci√≥n del carril de aceleraci√≥n en autopista:", opts: ["Estacionar", "Incorporarse con velocidad", "Emergencia", "Adelantar"], a: 1, learn: "üöÄ **Impulso:** Sirve para igualar la velocidad de los que ya van en la autopista antes de entrar." },
        { q: "6. Sanci√≥n por conducir con licencia vencida (M.40):", opts: ["Amonestaci√≥n", "Multa + Retenci√≥n", "Cancelaci√≥n", "Nada si revalida"], a: 1, learn: "üö´ **Sin Licencia:** Manejar con el brevete vencido es como manejar sin √©l: Multa y se llevan el auto." },
        { q: "7. L√≠mite m√°ximo velocidad auto (A-I) en carreteras:", opts: ["80 km/h", "90 km/h", "100 km/h", "120 km/h"], a: 2, learn: "üõ£Ô∏è **Tope:** En carretera abierta, un auto particular puede ir hasta 100 km/h (si no hay se√±al que diga menos)." },
        { q: "8. Polic√≠a dice PASE pero sem√°foro est√° en ROJO:", opts: ["Sem√°foro manda", "Polic√≠a manda (avanzar)", "Esperar verde", "Preguntar"], a: 1, learn: "üëÆ **Jerarqu√≠a:** La orden del Polic√≠a siempre est√° por encima del sem√°foro y las se√±ales." },
        { q: "9. Vigencia Certificado Salud para tr√°mite licencia:", opts: ["15 d√≠as", "6 meses", "1 a√±o", "Indefinido"], a: 1, learn: "ü©∫ **Tiempo:** Tienes 6 meses desde que te dan el apto m√©dico para terminar tus ex√°menes y tr√°mites." },
        { q: "10. Distancia m√≠nima estacionar de un grifo/hidrante:", opts: ["1 metro", "3 metros", "5 metros", "10 metros"], a: 2, learn: "üöí **Emergencia:** Deja 5 metros libres alrededor de los hidrantes para que los bomberos puedan trabajar." },
        { q: "11. Significado l√≠neas blancas discontinuas:", opts: ["No adelantar", "Opuestos", "Mismo sentido/Permite cruzar", "Estacionamiento"], a: 2, learn: "‚ö™ **Permiso:** Si la l√≠nea es segmentada (a trozos), puedes cambiar de carril o adelantar con cuidado." },
        { q: "12. Fuga en accidente: ¬øQui√©n cubre al peat√≥n?", opts: ["Nadie", "SIS", "Fondo de Compensaci√≥n SOAT", "Municipio"], a: 2, learn: "üè• **Fondo:** Si el chofer huye, existe un Fondo del MTC que cubre los gastos m√©dicos de las v√≠ctimas." },
        { q: "13. Profundidad m√≠nima surco llanta auto (M1):", opts: ["0.5 mm", "1.6 mm", "3.0 mm", "5.0 mm"], a: 1, learn: "üåßÔ∏è **Aquaplaning:** Necesitas m√≠nimo 1.6mm de dibujo para que la llanta pueda evacuar agua y no patinar." },
        { q: "14. ¬øNeblineros en ciudad sin niebla?:", opts: ["S√≠, est√©tica", "S√≠, baches", "Prohibido (deslumbran)", "Solo traseras"], a: 2, learn: "üí° **Respeto:** Los neblineros son muy fuertes. Usarlos sin niebla ciega a los dem√°s conductores." },
        { q: "15. Adelantar veh√≠culo averiado pisando continua:", opts: ["Nunca", "Excepcionalmente (seguridad)", "R√°pido", "Solo con polic√≠a"], a: 1, learn: "‚ö†Ô∏è **Excepci√≥n:** Si hay un obst√°culo inm√≥vil, puedes rebasarlo con cuidado aunque haya l√≠nea continua." },
        { q: "16. Puntos perdidos por infracci√≥n LEVE:", opts: ["1-20 puntos", "30 puntos", "50 puntos", "No restan puntos"], a: 0, learn: "üìâ **Acumulaci√≥n:** Las faltas leves suman entre 1 y 20 puntos en contra en tu r√©cord." },
        { q: "17. Documento estado mec√°nico (auto antiguo):", opts: ["Factura taller", "CITV (Revisi√≥n T√©cnica)", "Tarjeta Propiedad", "Manual"], a: 1, learn: "üîß **Certificado:** La √∫nica prueba v√°lida para la polic√≠a de que tu auto funciona bien es el CITV vigente." },
        { q: "18. ¬øNeutro en bajada para ahorrar?:", opts: ["S√≠, ahorra", "Prohibido/Peligroso", "S√≠ con freno", "Solo recta"], a: 1, learn: "üõë **Peligro:** ¬°Jam√°s! En neutro el auto se embala y pierdes el control. Baja siempre enganchado en cambio." },
        { q: "19. Se√±al vertical color MARR√ìN:", opts: ["Tur√≠stica/Arqueol√≥gica", "Escolar", "Mec√°nico", "Destino"], a: 0, learn: "üè∫ **Turismo:** El color marr√≥n en se√±ales es exclusivo para lugares de inter√©s tur√≠stico o hist√≥rico." },
        { q: "20. Conducir sin lentes (si la licencia lo exige):", opts: ["Nada", "Educativa", "Infracci√≥n Grave (G.19)", "Ponerse"], a: 2, learn: "üëì **Restricci√≥n:** Si tu licencia dice 'Lentes', es OBLIGATORIO usarlos. No hacerlo es una falta Grave." },
        { q: "21. Explique 'No bloquear cruce':", type: "TEXT", key: ["malla", "amarillo", "bloquear", "detener", "intersecci√≥n"], learn: "‚ùå **Bloqueo:** Nunca entres a una intersecci√≥n si no tienes espacio libre para salir al otro lado." },
        { q: "22. Vigencia revalidaci√≥n (plazos):", type: "TEXT", key: ["10", "8", "5"], learn: "üìÖ **Plazos:** A-I (10 a√±os), Profesionales (3 a√±os). La vigencia baja si tienes sanciones." },
        { q: "23. GNV/GLP Documento (Oral):", type: "AUDIO", key: ["certificado", "conformidad"], learn: "üîä **Oral:** Mencione el documento que avala el cambio de combustible." },
        { q: "24. Se√±al Chevron (Oral):", type: "AUDIO", key: ["curva", "guiar"], learn: "üîä **Oral:** Describa la funci√≥n de los delineadores de curva." }
    ],
    'C1': [
        { q: "1. Edad m√°xima para ser titular de licencia profesional:", opts: ["70 a√±os", "75 a√±os", "65 a√±os", "No existe l√≠mite", "80 a√±os"], a: 4, learn: "üë¥ **L√≠mite:** La edad m√°xima absoluta para tener licencia profesional (A-II, A-III) es de 80 a√±os." },
        { q: "2. Tolerancia en control de peso por eje (pesaje din√°mico):", opts: ["5%", "3%", "8%", "10%", "No existe tolerancia"], a: 1, learn: "‚öñÔ∏è **Balanzas Din√°micas:** Al pesar veh√≠culos en movimiento, se permite un error del 3%." },
        { q: "3. Color de fondo para se√±ales informativas de turismo/historia:", opts: ["Azul", "Verde", "Blanco", "Marr√≥n (Caf√©)", "Naranja"], a: 3, learn: "üè∫ **Turismo:** Las se√±ales que gu√≠an a museos, ruinas o parques siempre tienen fondo MARR√ìN." },
        { q: "4. Jornada m√°xima de conducci√≥n continua en servicio nocturno:", opts: ["5 horas", "4 horas", "6 horas", "3 horas", "10 horas"], a: 1, learn: "üåô **Fatiga:** De noche el riesgo aumenta, por lo que solo se permite conducir 4 horas seguidas (vs 5 de d√≠a)." },
        { q: "5. Longitud m√°xima para √≥mnibus de 2 o 3 ejes:", opts: ["12.00 m", "14.00 m", "13.20 m", "15.00 m", "12.60 m"], a: 2, learn: "üöå **Dimensiones:** El largo m√°ximo est√°ndar para buses de 2 o 3 ejes es de 13.20 metros." },
        { q: "6. Vigencia de licencia A-IIb revalidada tras sanci√≥n MUY GRAVE:", opts: ["3 a√±os", "5 a√±os", "4 a√±os", "1 a√±o", "2 a√±os"], a: 4, learn: "üìâ **Castigo:** Una falta Muy Grave reduce dr√°sticamente la vigencia de tu pr√≥xima licencia a solo 2 a√±os." },
        { q: "7. Forma y color de se√±al preventiva P-49 'Zona Escolar':", opts: ["Pentagonal/Amarillo Lim√≥n", "Romboidal/Amarillo", "Rectangular/Blanco", "Circular/Rojo", "Romboidal/Naranja"], a: 0, learn: "üè´ **√önica:** La se√±al de escuela es la √∫nica con forma de casita (pent√°gono) y color amarillo lim√≥n." },
        { q: "8. Definici√≥n t√©cnica de '√Årea Saturada' (RENAT):", opts: ["Paraderos informales", "Vel < 10km/h", ">1000 veh/h", "Contaminaci√≥n/Congesti√≥n", "Zona comercial"], a: 3, learn: "üå´Ô∏è **Saturaci√≥n:** Se declara saturada una zona cuando la congesti√≥n o el humo afectan la calidad de vida." },
        { q: "9. ¬øQu√© define a la Categor√≠a O4?", opts: ["Remolque <0.75t", "Remolque >10t", "Pasajeros 4 ruedas", "Carga >12t", "Remolque 3.5-10t"], a: 1, learn: "üöõ **Remolques:** La categor√≠a O es para remolques. O4 son los m√°s pesados (m√°s de 10 toneladas)." },
        { q: "10. Significado de l√≠nea central amarilla continua doble:", opts: ["Separaci√≥n mismo sentido", "Adelantamiento", "Opuestos/Prohibido adelantar", "Reversible", "Borde"], a: 2, learn: "üöß **Muro:** La doble l√≠nea amarilla es una pared virtual. Separa sentidos opuestos y NUNCA se cruza." },
        { q: "11. Autoridad competente para licencias Clase B (motos):", opts: ["MTC", "Gobierno Regional", "PNP", "Touring", "Municipalidad Provincial"], a: 4, learn: "üõµ **Jurisdicci√≥n:** Las licencias de moto y mototaxi las emiten exclusivamente las Municipalidades Provinciales." },
        { q: "12. Profundidad m√≠nima de neum√°ticos M3 o N3:", opts: ["2.0 mm", "1.6 mm", "3.0 mm", "1.0 mm", "1.5 mm"], a: 0, learn: "üöö **Agarre:** Buses y camiones necesitan m√°s profundidad de cocada (2.0 mm) que los autos (1.6 mm)." },
        { q: "13. √Åmbito territorial del Servicio de Auto Colectivo:", opts: ["Nacional", "Provincial", "Distrital", "Regional", "Internacional"], a: 3, learn: "üöó **Colectivos:** Formalmente, el servicio de auto colectivo se autoriza en el √°mbito Regional (entre provincias)." },
        { q: "14. Altura m√≠nima letra se√±al informativa en v√≠a de 90-120 km/h:", opts: ["15.0 cm", "25.0 cm", "20.0 cm", "30.0 cm", "35.0 cm"], a: 1, learn: "üìè **Legibilidad:** A alta velocidad (autopista), las letras deben medir 25cm para leerse a tiempo." },
        { q: "15. Vigencia del certificado de salud registrado:", opts: ["1 a√±o", "3 meses", "6 meses", "30 d√≠as", "Indefinida"], a: 2, learn: "ü©∫ **Examen M√©dico:** Una vez aprobado, tienes 6 meses de validez para completar tu tr√°mite de licencia." },
        { q: "16. Ancho m√°ximo permitido para un veh√≠culo (sin espejos):", opts: ["2.40 m", "2.50 m", "2.80 m", "3.00 m", "2.60 m"], a: 4, learn: "üìê **Ancho:** Ning√∫n veh√≠culo est√°ndar puede medir m√°s de 2.60 metros de ancho." },
        { q: "17. Color del recuadro del s√≠mbolo en se√±ales de servicios (azules):", opts: ["Blanco", "Negro", "Amarillo", "Rojo", "No lleva"], a: 0, learn: "‚õΩ **Contraste:** En se√±ales azules (servicios), el √≠cono va dentro de un recuadro blanco para resaltar." },
        { q: "18. Condici√≥n para obtener licencia A-I a los 16 a√±os:", opts: ["Permiso padres", "Estudiante mec√°nica", "Veh√≠culo propio", "Casado/T√≠tulo (Capacidad)", "Solo autom√°tico"], a: 3, learn: "üíç **Emancipaci√≥n:** A los 16 a√±os solo puedes conducir si tienes plena capacidad civil (est√°s casado o tienes t√≠tulo)." },
        { q: "19. Relaci√≥n potencia/peso m√≠nima para M3 y N3:", opts: ["5.5 kW/t", "4.85 kW/t", "6.0 kW/t", "4.0 kW/t", "7.2 kW/t"], a: 1, learn: "‚ö° **Potencia:** Para no ser una tortuga en subidas, el veh√≠culo debe tener al menos 4.85 kW por cada tonelada." },
        { q: "20. Vigencia nueva A-I tras sanci√≥n MUY GRAVE (suspensi√≥n):", opts: ["2 a√±os", "10 a√±os", "5 a√±os", "8 a√±os", "3 a√±os"], a: 2, learn: "üìâ **A-I Castigada:** Si tienes A-I (normalmente 10 a√±os) y cometes falta Muy Grave, te bajan la vigencia a 5 a√±os." },
        { q: "21. C√≥digo de se√±al preventiva 'Delineador de Curva' (Chevron):", opts: ["P-1A", "P-60", "P-58", "P-33", "P-61"], a: 4, learn: "‚Ü©Ô∏è **C√≥digo:** El Chevron (rect√°ngulo con flecha) se identifica como P-61 en el manual." },
        { q: "22. Medida preventiva si veh√≠culo de transporte no tiene SOAT:", opts: ["Retenci√≥n", "Multa", "Suspensi√≥n", "Interrupci√≥n del viaje", "Remoci√≥n"], a: 0, learn: "üõë **Sin Seguro:** Sin SOAT el veh√≠culo es un peligro ilegal, la polic√≠a aplica RETENCI√ìN inmediata." },
        { q: "23. Definici√≥n de 'M√°quina Amarilla' (RNV):", opts: ["Cat S", "Requiere placa", "Cat N3", "No es veh√≠culo SNTT", "Circula libre"], a: 3, learn: "üöú **No es Transporte:** Las m√°quinas de construcci√≥n no est√°n hechas para viajar en carretera (No SNTT)." },
        { q: "24. Distancia m√≠nima se√±al PARE en zona rural:", opts: ["1 metro", "2 metros", "3 metros", "5 metros", "0.5 metros"], a: 1, learn: "üëÄ **Visibilidad Rural:** En el campo, el PARE se pone un poco antes (2 metros) para ver mejor el cruce." },
        { q: "25. Antig√ºedad requerida para recategorizar a A-IIb:", opts: ["2a AI / 1a AIIa", "1a AI", "3 a√±os AI / 1 a√±o AIIa", "4a AI", "Ninguna"], a: 2, learn: "üìÖ **Escalera:** Para manejar microb√∫s (A-IIb) necesitas 3 a√±os de experiencia en auto (A-I) o 1 a√±o en taxi (A-IIa)." },
        { q: "26. Categor√≠as obligadas a usar l√°minas retrorreflectivas:", opts: ["N3/O4", "M3/N3", "M1/M2/M3...", "Todos", "M2, M3 y N"], a: 4, learn: "‚ú® **Visibilidad:** Cintas reflectivas son obligatorias para transporte de pasajeros (M2, M3) y toda carga (N)." },
        { q: "27. Significado de se√±al R-50:", opts: ["Contrario", "Distancia", "No bloquear cruce", "Ceda el paso", "Solo buses"], a: 2, learn: "‚ùå **Anti-Bloqueo:** La R-50 indica 'Prohibido bloquear la intersecci√≥n' (usada con la malla ortogonal)." },
        { q: "28. Plazo conservaci√≥n manifiesto de usuarios impreso:", opts: ["1 a√±o", "30 d√≠as", "60 d√≠as", "90 d√≠as", "5 a√±os"], a: 1, learn: "üìÇ **Archivo:** La empresa debe guardar la lista de pasajeros f√≠sica por 30 d√≠as para control." },
        { q: "29. Discapacidad no registrada (Oral):", type: "AUDIO", key: ["retener", "comunicar", "reexaminaci√≥n"], learn: "üîä **Oral:** Procedimiento ante discapacidad no registrada en licencia." },
        { q: "30. L√°minas Retro Specs (Oral):", type: "AUDIO", key: ["rojo", "blanco", "lateral", "posterior"], learn: "üîä **Oral:** Colores y ubicaci√≥n de l√°minas retroreflectivas." },
        { q: "31. Prohibido Adelantar (Oral):", type: "AUDIO", key: ["continua", "banderola", "R-16"], learn: "üîä **Oral:** Se√±alizaci√≥n para prohibici√≥n de adelantamiento." }
    ],
    'C2': [
        { q: "1. Si un conductor de 76 a√±os revalida su licencia A-I, ¬øpor qu√© periodo se otorga?", opts: ["1 a√±o", "5 a√±os", "2 a√±os", "3 a√±os", "6 meses"], a: 0, learn: "üë¥ **Edad Avanzada:** A partir de los 76 a√±os, la revalidaci√≥n es anual (cada 1 a√±o) por seguridad m√©dica." },
        { q: "2. Caracter√≠stica √∫nica de la forma de la se√±al preventiva P-61 (Chevron):", opts: ["Circular", "Cuadrada (Rombo)", "Rectangular", "Triangular", "Pentagonal"], a: 2, learn: "üõë **Se√±ales:** El Chevron es la √∫nica preventiva rectangular; sirve para delinear curvas peligrosas." },
        { q: "3. Tolerancia de peso permitida para el Peso Bruto Vehicular en pesaje din√°mico:", opts: ["5%", "2%", "8%", "No existe", "3%"], a: 4, learn: "‚öñÔ∏è **Pesaje:** En balanzas din√°micas (movimiento), se perdona un error de hasta el 3% del peso total." },
        { q: "4. Jornada m√°xima continua de conducci√≥n en turno NOCTURNO:", opts: ["3h 30min", "5 horas", "4h 30min", "4 horas", "6 horas"], a: 3, learn: "üåô **Fatiga:** De noche el riesgo aumenta, por lo que solo se permite conducir 4 horas seguidas (vs 5 de d√≠a)." },
        { q: "5. Color de fondo espec√≠fico para se√±ales preventivas en Zonas Escolares (P-49):", opts: ["Amarillo", "Naranja", "Amarillo Lim√≥n (Verde)", "Blanco", "Azul"], a: 2, learn: "üè´ **Visibilidad:** Las zonas escolares usan 'Amarillo Lim√≥n Fluorescente' para captar atenci√≥n inmediata." },
        { q: "6. Requisito de experiencia para recategorizar a A-IIIa:", opts: ["A-I por 3 a√±os", "A-IIb por 2 a√±os", "A-IIa por 2 a√±os", "A-IIb por 1 a√±o", "A-I por 4 a√±os"], a: 1, learn: "üìà **Carrera:** Para llegar a la cima (A-IIIa), necesitas haber conducido con la A-IIb al menos 2 a√±os." },
        { q: "7. Condici√≥n t√©cnica sobre los bordes de los parachoques de un M1:", opts: ["Cromados", "Acero externo", "Sin filos cortantes", "60cm altura", "Flexibles"], a: 2, learn: "üî™ **Seguridad Peatonal:** Los parachoques no pueden tener filos o √°ngulos que corten en caso de atropello." },
        { q: "8. ¬øQu√© indica la se√±al R-14A (flecha blanca horizontal sobre fondo negro)?", opts: ["Doble sentido", "Voltear obligado", "Tr√°nsito en un sentido", "Autopista", "Sin salida"], a: 2, learn: "‚¨ÖÔ∏è **Sentido:** La flecha en fondo negro confirma que la v√≠a tiene una sola direcci√≥n de circulaci√≥n." },
        { q: "9. Se considera 'Abandono del Servicio' si se deja de prestar sin causa por:", opts: ["5 d√≠as", "3 d√≠as", "15 d√≠as", "24 horas", "10 d√≠as en un mes"], a: 4, learn: "üöå **Continuidad:** Si faltas 10 d√≠as (seguidos o no) en un mes, pierdes la concesi√≥n de ruta." },
        { q: "10. Profundidad m√≠nima de cocada neum√°tico N3 (cami√≥n pesado):", opts: ["1.6 mm", "1.0 mm", "3.0 mm", "2.0 mm", "4.0 mm"], a: 3, learn: "üöö **Llantas:** Los camiones pesados (N3) requieren m√°s agarre: m√≠nimo 2.0 mm de profundidad." },
        { q: "11. Tipo de alfabeto recomendado para se√±ales informativas (Altura 20cm):", opts: ["Serie A", "Serie B", "Serie E", "Serie C", "Times New Roman"], a: 2, learn: "üî§ **Legibilidad:** La 'Serie E' es una letra ancha y clara, ideal para leerse a alta velocidad." },
        { q: "12. Vigencia de Licencia A-I tras ser sancionado con infracci√≥n LEVE:", opts: ["5 a√±os", "8 a√±os", "10 a√±os", "2 a√±os", "3 a√±os"], a: 1, learn: "üìÜ **Castigo:** Una falta Leve reduce tu vigencia de 10 a 8 a√±os. Una Grave la bajar√≠a a 5." },
        { q: "13. ¬øQu√© indica la se√±al P-60 (Tri√°ngulo 'NO ADELANTAR')?", opts: ["Fin de prohibici√≥n", "Zona de NO adelantar", "Cruce izquierda", "Estrechamiento", "Derrumbes"], a: 1, learn: "üö´ **Adelantamiento:** Esta se√±al se coloca a la izquierda para advertir que es peligroso pasar a otro auto." },
        { q: "14. Requisito en factura para nacionalizar motor remanufacturado:", opts: ["A√±o", "Potencia", "N√∫mero estampado", "Kilometraje", "Color"], a: 2, learn: "üî¢ **Identidad:** El motor debe tener su n√∫mero grabado claramente identificado en los papeles." },
        { q: "15. Duraci√≥n acumulada m√°xima de conducci√≥n (2 choferes, 24 horas):", opts: ["8 horas", "12 horas", "14 horas", "10 horas", "9 horas"], a: 1, learn: "‚è±Ô∏è **Turnos:** Aunque haya dos choferes, ninguno puede manejar m√°s de 12 horas en total por d√≠a." },
        { q: "16. Diferencia de color de la se√±al R-30F (Velocidad en Curva):", opts: ["Blanco/Rojo", "Amarillo Fluo", "Fondo amarillo", "Naranja", "Azul"], a: 2, learn: "‚ö†Ô∏è **Excepci√≥n:** Es una se√±al de regulaci√≥n (velocidad) pero usa fondo amarillo porque advierte peligro." },
        { q: "17. Edad m√≠nima para obtener DIRECTAMENTE licencia B-IIc (Mototaxi):", opts: ["21 a√±os", "16 a√±os", "20 a√±os", "18 a√±os", "23 a√±os"], a: 3, learn: "üõ∫ **Edad:** Para manejar mototaxi profesionalmente, basta ser mayor de edad (18 a√±os)." },
        { q: "18. Dispositivo obligatorio de control para buses M3:", opts: ["GPS", "Tac√≥grafo", "Radio", "C√°mara", "Sensor"], a: 1, learn: "üìº **Caja Negra:** El tac√≥grafo registra velocidad y tiempos de conducci√≥n para control policial." },
        { q: "19. ¬øQu√© significa la se√±al I-28 (Rect√°ngulo azul con ola blanca)?", opts: ["Playa", "Balneario", "Inundaci√≥n", "Tsunami", "Puerto"], a: 3, learn: "üåä **Emergencia:** Indica zona de riesgo por Tsunami, vital en la costa peruana." },
        { q: "20. Vigencia de revalidaci√≥n para conductor profesional de 72 a√±os:", opts: ["5 a√±os", "1 a√±o", "2 a√±os", "3 a√±os", "6 meses"], a: 1, learn: "üë¥ **Profesionales:** A partir de los 70 a√±os, los profesionales revalidan anualmente." },
        { q: "21. Velocidad del limitador en transporte p√∫blico nacional:", opts: ["90 km/h", "100 km/h", "80 km/h", "120 km/h", "110 km/h"], a: 0, learn: "üöå **Tope:** Los buses interprovinciales no pueden f√≠sicamente superar los 90 km/h por ley." },
        { q: "22. Ancho m√≠nimo de una 'L√≠nea de Pare':", opts: ["0.30 m", "0.40 m", "0.60 m", "0.50 m", "0.25 m"], a: 3, learn: "üìè **Se√±alizaci√≥n:** La l√≠nea de detenci√≥n es gruesa (medio metro) para verse bien desde lejos." },
        { q: "23. Categor√≠a de cuatriciclo de carga (450kg):", opts: ["L5", "L7", "L6", "M1", "N1"], a: 1, learn: "üöú **Clasificaci√≥n:** Los cuatriciclos pesados de carga entran en la categor√≠a L7." },
        { q: "24. ¬øCu√°ndo vuelve a sacar licencia alguien cancelado por ebriedad + accidente?", opts: ["3 a√±os", "Nunca", "5 a√±os", "10 a√±os", "1 a√±o"], a: 1, learn: "üç∑ **Tolerancia Cero:** Ebriedad con accidente es inhabilitaci√≥n DEFINITIVA. Nunca m√°s maneja." },
        { q: "25. Se√±al R-58A (Auto izquierda / Bici derecha) indica:", opts: ["No bicis", "Compartida", "Exclusiva", "V√≠a segregada", "Cruce"], a: 3, learn: "üö¥ **Orden:** Indica que cada uno tiene su carril separado: autos a un lado, bicis al otro." },
        { q: "26. Veh√≠culos exonerados de antiempotramiento posterior:", opts: ["N2", "O3", "Distancia <350mm", "Cisternas", "Volquetes"], a: 2, learn: "üìê **F√≠sica:** Si el chasis ya es muy bajo (menos de 35cm del suelo), no necesita defensa extra." },
        { q: "27. Sanci√≥n a Escuela por dar constancia sin cumplir horas:", opts: ["1 UIT", "Suspensi√≥n", "15 UIT + Cancelaci√≥n", "Amonestaci√≥n", "5 UIT"], a: 2, learn: "üè´ **Fraude:** Es una falta muy grave que cierra la escuela definitivamente y impone multa millonaria." },
        { q: "28. Color de cruz en se√±ales de emergencia (Hospital/Primeros Auxilios):", opts: ["Azul/Blanco", "Azul/Recuadro Blanco/Cruz Roja", "Blanco/Rojo", "Verde", "Rojo"], a: 1, learn: "üè• **S√≠mbolo:** La Cruz Roja sobre fondo blanco es el est√°ndar internacional de salud en estas se√±ales." },
        { q: "29. Antig√ºedad m√°xima permanencia transporte mercanc√≠as:", opts: ["15 a√±os", "20 a√±os", "30 a√±os", "10 a√±os", "No sujeto (si pasa ITV)"], a: 4, learn: "üöõ **Carga:** Los camiones no tienen l√≠mite de edad, siempre que aprueben su Revisi√≥n T√©cnica (ITV)." },
        { q: "30. ¬øQu√© indica una l√≠nea discontinua m√°s ANCHA de lo normal?", opts: ["No cambio", "Borde", "L√≠nea de continuidad", "Estacionamiento", "Opuestos"], a: 2, learn: "üõ£Ô∏è **Salidas:** Esa l√≠nea gorda avisa que el carril se va a terminar o desviar pronto." },
        { q: "31. Bonif. Suspensi√≥n (Oral):", type: "AUDIO", key: ["10%", "5%", "delantero"], learn: "üîä **Oral:** Responde sobre bonificaci√≥n t√©cnica en suspensi√≥n." },
        { q: "32. Rampa Frenado (Oral):", type: "AUDIO", key: ["rojo", "tachas", "1000"], learn: "üîä **Oral:** Describe las caracter√≠sticas de una rampa de emergencia." },
        { q: "33. Suspensi√≥n Precautoria (Oral):", type: "AUDIO", key: ["30%", "treinta", "flota"], learn: "üîä **Oral:** Porcentaje de flota para suspensi√≥n precautoria." }
    ]
};

const app = {
    cat: 'A-I',
    unlocked: 0,
    currCfg: null,
    qIdx: 0,
    score: 0,
    timer: null,
    timeLeft: 900, // 15 minutos

    config: [
        { id: 'A1', name: 'Nivel A1', min: 60, max: 100, mc: 5 },
        { id: 'A2', name: 'Nivel A2', min: 70, max: 120, mc: 5 },
        { id: 'B1', name: 'Nivel B1', min: 100, max: 140, mc: 6, open: 10 },
        { id: 'B2', name: 'Nivel B2', min: 120, max: 160, mc: 5, open: 15 },
        { id: 'C1', name: 'Nivel C1', min: 140, max: 170, mc: 5, open: 10 },
        { id: 'C2', name: 'Nivel C2', min: 150, max: 180, mc: 5, open: 10 }
    ],

    init: function() {
        const s = localStorage.getItem('drive_lvl');
        if(s) this.unlocked = parseInt(s);
        this.renderLvl();
        this.applyEffects();
    },

    // Aplica el efecto de luz a todos los elementos con clase .spotlight
    applyEffects: function() {
        const els = document.querySelectorAll('.spotlight');
        els.forEach(el => {
            el.onmousemove = e => {
                const rect = el.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                el.style.setProperty('--mouse-x', `${x}px`);
                el.style.setProperty('--mouse-y', `${y}px`);
            }
        });
    },

    reset: function() {
        this.stopTimer();
        localStorage.removeItem('drive_lvl');
        location.reload();
    },

    nav: function(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    // Animaci√≥n y selecci√≥n de categor√≠a
    setCat: function(c, btn) {
        // A√±adir clase de animaci√≥n
        btn.classList.add('card-selected');
        
        // Esperar 400ms antes de cambiar de vista
        setTimeout(() => {
            this.cat = c;
            document.getElementById('cat-lbl').innerText = c;
            this.renderLvl();
            this.nav('v-levels');
            // Quitar la clase por si vuelve atr√°s
            btn.classList.remove('card-selected');
        }, 400);
    },

    renderLvl: function() {
        const c = document.getElementById('lvl-list');
        c.innerHTML = '';
        this.config.forEach((l, i) => {
            const u = i <= this.unlocked;
            const d = document.createElement('div');
            d.className = `lvl-row spotlight ${u ? 'unlocked' : 'locked'}`;
            d.innerHTML = `
                <div><strong>${l.name}</strong><br><small style="color:var(--text-dim)">M√≠nimo: ${l.min} pts</small></div>
                <div class="badge">${u ? 'ABIERTO' : 'üîí'}</div>
            `;
            if(u) d.onclick = () => this.start(i);
            c.appendChild(d);
        });
        this.applyEffects();
    },

    start: function(i) {
        const cfg = this.config[i];
        this.currCfg = { ...cfg, qs: DB[cfg.id] || DB['A1'] };
        this.nav('v-study');
        this.renderStudy();
    },

    renderStudy: function() {
        const c = document.getElementById('study-container');
        c.innerHTML = '';
        this.currCfg.qs.forEach((item) => {
            let cleanQuestion = item.q.replace(/^\d+\.\s*/, '');
            let teaching = item.learn ? item.learn : "üí° <em>Tip: Revisa el Reglamento Nacional de Tr√°nsito.</em>";
            const card = document.createElement('div');
            card.className = 'study-card';
            card.innerHTML = `<div class="study-q">${cleanQuestion}</div><div class="study-a">${teaching}</div>`;
            c.appendChild(card);
        });
    },

    startExam: function() {
        this.qIdx = 0;
        this.score = 0;
        this.nav('v-exam');
        this.renderQ();
        this.startTimer(); // Iniciar el reloj solo aqu√≠
    },

    // L√≥gica del Temporizador
    startTimer: function() {
        this.timeLeft = 900; // 15 minutos
        this.updateTimerDisplay();
        const display = document.getElementById('timer-display');
        display.classList.add('active');
        display.classList.remove('danger');
        
        if(this.timer) clearInterval(this.timer);
        
        this.timer = setInterval(() => {
            this.timeLeft--;
            this.updateTimerDisplay();
            
            // Alerta visual si queda menos de 1 minuto
            if(this.timeLeft < 60) display.classList.add('danger');
            
            if(this.timeLeft <= 0) {
                this.stopTimer();
                this.finish(); // Se acab√≥ el tiempo
            }
        }, 1000);
    },

    stopTimer: function() {
        if(this.timer) clearInterval(this.timer);
        const display = document.getElementById('timer-display');
        display.classList.remove('active', 'danger');
    },

    updateTimerDisplay: function() {
        const m = Math.floor(this.timeLeft / 60);
        const s = this.timeLeft % 60;
        document.getElementById('timer-display').innerText = 
            `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    },

    renderQ: function() {
        const q = this.currCfg.qs[this.qIdx];
        const tot = this.currCfg.qs.length;
        document.getElementById('ex-name').innerText = this.currCfg.name;
        document.getElementById('ex-count').innerText = `${this.qIdx+1}/${tot}`;
        document.getElementById('bar').style.width = `${((this.qIdx)/tot)*100}%`;
        document.getElementById('q-text').innerText = q.q;

        const area = document.getElementById('q-area');
        area.innerHTML = '';

        if(q.type === 'TEXT') {
            area.innerHTML = `<textarea id="in-txt" placeholder="Escribe tu respuesta..."></textarea><button class="action-btn spotlight primary" onclick="app.ansText()">Enviar Respuesta</button>`;
        } else if(q.type === 'AUDIO') {
            area.innerHTML = `<div class="mic-btn" onclick="app.rec(this)">üé§</div><p id="rec-s" style="text-align:center;font-size:0.9rem;color:var(--text-dim)">Toca para grabar</p><input type="hidden" id="in-aud"><button id="b-aud" class="action-btn spotlight primary" style="display:none" onclick="app.ansAudio()">Enviar Respuesta</button>`;
        } else {
            q.opts.forEach((o, i) => {
                const b = document.createElement('button');
                b.className = 'opt-btn spotlight';
                b.innerText = o;
                b.onclick = () => app.ansMC(i);
                area.appendChild(b);
            });
        }
        this.applyEffects();
    },

    ansMC: function(i) {
        if(i === this.currCfg.qs[this.qIdx].a) this.score += this.currCfg.mc;
        this.next();
    },

    ansText: function() {
        const val = document.getElementById('in-txt').value.toLowerCase();
        this.scoreOpen(val);
    },

    rec: function(btn) {
        const s = document.getElementById('rec-s');
        btn.classList.add('recording');
        s.innerText = "Escuchando...";
        setTimeout(() => {
            btn.classList.remove('recording');
            s.innerText = "Grabaci√≥n finalizada";
            document.getElementById('b-aud').style.display = 'block';
            document.getElementById('in-aud').value = this.currCfg.qs[this.qIdx].key[0];
        }, 1500);
    },

    ansAudio: function() {
        this.scoreOpen(document.getElementById('in-aud').value);
    },

    scoreOpen: function(val) {
        let hits = 0;
        this.currCfg.qs[this.qIdx].key.forEach(k => { if(val.includes(k)) hits++; });
        if(hits >= 1) {
            const pts = this.currCfg.open;
            const partial = this.currCfg.id === 'B2' ? 0.7 : 0.8;
            this.score += (hits >= 2 ? pts : (pts * partial));
        }
        this.next();
    },

    next: function() {
        if(this.qIdx < this.currCfg.qs.length - 1) { this.qIdx++; this.renderQ(); }
        else this.finish();
    },

    finish: function() {
        this.stopTimer(); // Detener reloj al terminar
        this.nav('v-result');
        if(this.score > this.currCfg.max) this.score = this.currCfg.max;
        this.score = Math.round(this.score);
        const pass = this.score >= this.currCfg.min;
        
        const val = document.getElementById('res-val');
        val.innerText = this.score;
        val.style.color = pass ? 'var(--success)' : 'var(--error)';
        
        document.getElementById('res-msg').innerText = pass ? "¬°FELICIDADES, APROBADO!" : `Necesitas m√≠nimo ${this.currCfg.min} pts para aprobar`;
        
        const cert = document.getElementById('cert');
        if(pass) {
            cert.style.display = 'block';
            document.getElementById('c-cat').innerText = this.cat;
            document.getElementById('c-lvl').innerText = this.currCfg.name;
            let n = "APROBADO";
            if(this.score === this.currCfg.max) n = "EXCELENTE";
            else if(this.score >= this.currCfg.max*0.9) n = "SOBRESALIENTE";
            document.getElementById('c-note').innerText = n;

            const idx = this.config.findIndex(l => l.id === this.currCfg.id);
            if(idx === this.unlocked) {
                this.unlocked++;
                localStorage.setItem('drive_lvl', this.unlocked);
            }
        } else {
            cert.style.display = 'none';
        }
    }
};
app.init();
</script>
</body>
</html>